# äº‹ä»¶æ¨é€ä¸çŠ¶æ€åŒæ­¥æœºåˆ¶

## ğŸ“‹ æ–‡æ¡£è¯´æ˜

æœ¬æ–‡æ¡£è¯¦ç»†æè¿° DataTrac ç³»ç»Ÿçš„äº‹ä»¶æ¨é€å’ŒçŠ¶æ€åŒæ­¥æœºåˆ¶ï¼Œç¡®ä¿å‰åç«¯æ•°æ®å±•ç¤ºä¸€è‡´æ€§ã€‚

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**æœ€åæ›´æ–°**: 2026-01-30  
**å®ç°çŠ¶æ€**: âœ… å·²å®Œæˆ

---

## ğŸ¯ è®¾è®¡ç›®æ ‡

### æ ¸å¿ƒéœ€æ±‚

1. **å®æ—¶æ€§**: æ¯ä¸ªçº¿ç¨‹æ‰§è¡Œå®Œæˆä¸€æ¬¡éƒ½ä¼šè¿”å›ç»“æœæ¨é€ç»™å‰ç«¯
2. **ä¸€è‡´æ€§**: å‰åç«¯æ•°æ®å±•ç¤ºä¸€è‡´ï¼Œæ•°æ®åº“ä¸å‰ç«¯åŒæ­¥
3. **ç»†ç²’åº¦**: æ‰¹æ¬¡çº§åˆ«çš„è¿›åº¦æ›´æ–°ï¼Œä¸ä»…æ˜¯ä»»åŠ¡å•å…ƒçº§åˆ«
4. **å¯é æ€§**: å³ä½¿å‰ç«¯åˆ·æ–°ï¼Œä¹Ÿèƒ½ä»æ•°æ®åº“æ¢å¤æ­£ç¡®çš„è¿›åº¦çŠ¶æ€

---

## ğŸ—ï¸ ä¸‰å±‚åŒæ­¥æ¶æ„

### æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç¬¬ä¸€å±‚: å†…å­˜ç¼“å­˜ (HashMap<String, Vec<TaskUnit>>)       â”‚
â”‚  - ä½œç”¨: å¿«é€Ÿè¯»å†™ï¼Œå‡å°‘æ•°æ®åº“æŸ¥è¯¢                        â”‚
â”‚  - æ›´æ–°æ—¶æœº: æ¯æ¬¡çŠ¶æ€/è¿›åº¦å˜åŒ–                           â”‚
â”‚  - æ•°æ®ç»“æ„: RwLock ä¿æŠ¤çš„ HashMap                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“ update_unit_xxx_with_sync
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç¬¬äºŒå±‚: æ•°æ®åº“æŒä¹…åŒ– (SQLite - task_units è¡¨)           â”‚
â”‚  - ä½œç”¨: æ•°æ®æŒä¹…åŒ–ï¼Œæ”¯æŒæ–­ç‚¹ç»­ä¼                         â”‚
â”‚  - æ›´æ–°æ—¶æœº: æ¯æ¬¡çŠ¶æ€/è¿›åº¦å˜åŒ–                           â”‚
â”‚  - å­—æ®µ: status, total_records, processed_records       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“ ProgressMonitor::update_progress
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç¬¬ä¸‰å±‚: å‰ç«¯å®æ—¶æ˜¾ç¤º (Tauri Event: task-progress)       â”‚
â”‚  - ä½œç”¨: ç”¨æˆ·ç•Œé¢å®æ—¶åé¦ˆ                                â”‚
â”‚  - æ¨é€æ—¶æœº: æ¯æ¬¡çŠ¶æ€/è¿›åº¦å˜åŒ–                           â”‚
â”‚  - äº‹ä»¶å: "task-progress"                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### åŒæ­¥ä¿è¯

| æ“ä½œç±»å‹ | å†…å­˜ç¼“å­˜ | æ•°æ®åº“ | å‰ç«¯æ¨é€ | æ‰§è¡Œæ–¹å¼ |
|---------|---------|--------|---------|---------|
| ä»»åŠ¡å•å…ƒå¼€å§‹ | âœ… | âœ… | âœ… | åŒæ­¥ï¼ˆé˜»å¡ï¼‰ |
| æ¯æ‰¹æ¬¡å®Œæˆ | âœ… | âœ… | âœ… | å¼‚æ­¥ï¼ˆä¸é˜»å¡ï¼‰ |
| ä»»åŠ¡å•å…ƒå®Œæˆ | âœ… | âœ… | âœ… | åŒæ­¥ï¼ˆé˜»å¡ï¼‰ |
| ä»»åŠ¡å•å…ƒå¤±è´¥ | âœ… | âœ… | âœ… | åŒæ­¥ï¼ˆé˜»å¡ï¼‰ |

---

## ğŸ“Š å®Œæ•´çš„äº‹ä»¶æ¨é€æµç¨‹

### æµç¨‹å›¾

```
ç”¨æˆ·ç‚¹å‡»"å¼€å§‹åŒæ­¥"
   â†“
SyncEngine.start_sync(task_id)
   â†“
åŠ è½½ä»»åŠ¡é…ç½® (threadCount, batchSize)
   â†“
TaskManager.execute_auto_mode()
   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å¹¶å‘æ‰§è¡Œ N ä¸ªä»»åŠ¡å•å…ƒ (N = threadCount)                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   â†“
æ¯ä¸ªä»»åŠ¡å•å…ƒç‹¬ç«‹æ‰§è¡Œï¼š
   â”‚
   â”œâ”€ ã€äº‹ä»¶ 1ã€‘çŠ¶æ€å˜æ›´: Pending â†’ Running
   â”‚   â”œâ”€ update_unit_status_with_sync()
   â”‚   â”œâ”€ æ›´æ–°å†…å­˜: task_units_cache
   â”‚   â”œâ”€ æ›´æ–°æ•°æ®åº“: UPDATE task_units SET status='running'
   â”‚   â””â”€ æ¨é€å‰ç«¯: emit("task-progress", {...})
   â”‚
   â”œâ”€ åˆ›å»º Pipeline (Reader + Writer)
   â”‚
   â”œâ”€ Pipeline.execute() - å¾ªç¯å¤„ç†æ‰¹æ¬¡
   â”‚   â”‚
   â”‚   â”œâ”€ ã€æ‰¹æ¬¡ 1ã€‘è¯»å– batchSize æ¡è®°å½•
   â”‚   â”‚   â”œâ”€ Reader.read_batch(2500)
   â”‚   â”‚   â”œâ”€ Transformer.transform()
   â”‚   â”‚   â”œâ”€ Writer.write_batch()
   â”‚   â”‚   â””â”€ ã€äº‹ä»¶ 2ã€‘è¿›åº¦æ›´æ–°
   â”‚   â”‚       â”œâ”€ update_unit_progress_with_sync()
   â”‚   â”‚       â”œâ”€ æ›´æ–°å†…å­˜: processed_records = 2500
   â”‚   â”‚       â”œâ”€ æ›´æ–°æ•°æ®åº“: UPDATE task_units SET processed_records=2500
   â”‚   â”‚       â””â”€ æ¨é€å‰ç«¯: emit("task-progress", {processed: 2500, total: 10000})
   â”‚   â”‚
   â”‚   â”œâ”€ ã€æ‰¹æ¬¡ 2ã€‘è¯»å– batchSize æ¡è®°å½•
   â”‚   â”‚   â””â”€ ã€äº‹ä»¶ 3ã€‘è¿›åº¦æ›´æ–°: processed_records = 5000
   â”‚   â”‚
   â”‚   â”œâ”€ ã€æ‰¹æ¬¡ 3ã€‘è¯»å– batchSize æ¡è®°å½•
   â”‚   â”‚   â””â”€ ã€äº‹ä»¶ 4ã€‘è¿›åº¦æ›´æ–°: processed_records = 7500
   â”‚   â”‚
   â”‚   â””â”€ ã€æ‰¹æ¬¡ 4ã€‘è¯»å– batchSize æ¡è®°å½•
   â”‚       â””â”€ ã€äº‹ä»¶ 5ã€‘è¿›åº¦æ›´æ–°: processed_records = 10000
   â”‚
   â””â”€ ã€äº‹ä»¶ 6ã€‘çŠ¶æ€å˜æ›´: Running â†’ Completed
       â”œâ”€ update_unit_status_with_sync()
       â”œâ”€ æ›´æ–°å†…å­˜: status = 'completed'
       â”œâ”€ æ›´æ–°æ•°æ®åº“: UPDATE task_units SET status='completed'
       â””â”€ æ¨é€å‰ç«¯: emit("task-progress", {...})
```

### æ¨é€é¢‘ç‡è®¡ç®—

**ç¤ºä¾‹é…ç½®**ï¼š
- `threadCount`: 4 (4ä¸ªä»»åŠ¡å•å…ƒå¹¶å‘)
- `batchSize`: 2500 (æ¯æ‰¹æ¬¡2500æ¡è®°å½•)
- ä»»åŠ¡å•å…ƒ: 3ä¸ªè¡¨ï¼Œæ¯ä¸ªè¡¨10000æ¡è®°å½•

**æ¨é€æ¬¡æ•°ç»Ÿè®¡**ï¼š

| äº‹ä»¶ç±»å‹ | å•ä¸ªå•å…ƒ | æ€»è®¡ (3ä¸ªå•å…ƒ) | è¯´æ˜ |
|---------|---------|---------------|------|
| å•å…ƒå¼€å§‹ | 1æ¬¡ | 3æ¬¡ | çŠ¶æ€: Pending â†’ Running |
| æ‰¹æ¬¡è¿›åº¦ | 4æ¬¡ | 12æ¬¡ | æ¯2500æ¡æ¨é€ä¸€æ¬¡ |
| å•å…ƒå®Œæˆ | 1æ¬¡ | 3æ¬¡ | çŠ¶æ€: Running â†’ Completed |
| **æ€»è®¡** | **6æ¬¡** | **18æ¬¡** | æ•´ä¸ªä»»åŠ¡æ‰§è¡ŒæœŸé—´ |

**æ¨é€é—´éš”**ï¼š
- å–å†³äºæ•°æ®å¤„ç†é€Ÿåº¦
- é€šå¸¸æ¯ç§’ 1-10 æ¬¡
- ä½¿ç”¨å¼‚æ­¥æ¨é€ï¼Œä¸é˜»å¡æ•°æ®å¤„ç†

---

## ğŸ”§ æ ¸å¿ƒå®ç°

### 1. çŠ¶æ€åŒæ­¥æ–¹æ³•

#### update_unit_status_with_sync

```rust
/// æ›´æ–°ä»»åŠ¡å•å…ƒçŠ¶æ€å¹¶åŒæ­¥åˆ°æ•°æ®åº“å’Œå‰ç«¯
pub async fn update_unit_status_with_sync(
    &self,
    task_id: &str,
    unit_name: &str,
    status: TaskUnitStatus,
    progress_monitor: &Arc<ProgressMonitor>,
) -> Result<()> {
    // 1. æ›´æ–°å†…å­˜ç¼“å­˜
    self.update_unit_status(task_id, unit_name, status.clone());

    // 2. åŒæ­¥åˆ°æ•°æ®åº“
    self.storage
        .update_unit_status(task_id, unit_name, status)
        .await?;

    // 3. æ¨é€åˆ°å‰ç«¯
    self.push_progress_to_frontend(task_id, progress_monitor)?;

    Ok(())
}
```

**è°ƒç”¨æ—¶æœº**ï¼š
- ä»»åŠ¡å•å…ƒå¼€å§‹æ‰§è¡Œæ—¶
- ä»»åŠ¡å•å…ƒæ‰§è¡Œå®Œæˆæ—¶
- ä»»åŠ¡å•å…ƒæ‰§è¡Œå¤±è´¥æ—¶

#### update_unit_progress_with_sync

```rust
/// æ›´æ–°ä»»åŠ¡å•å…ƒè¿›åº¦å¹¶åŒæ­¥åˆ°æ•°æ®åº“å’Œå‰ç«¯
pub async fn update_unit_progress_with_sync(
    &self,
    task_id: &str,
    unit_name: &str,
    total: i64,
    processed: i64,
    progress_monitor: &Arc<ProgressMonitor>,
) -> Result<()> {
    // 1. æ›´æ–°å†…å­˜ç¼“å­˜
    self.update_unit_progress(task_id, unit_name, total, processed);

    // 2. åŒæ­¥åˆ°æ•°æ®åº“
    self.storage
        .update_unit_progress(task_id, unit_name, total, processed)
        .await?;

    // 3. æ¨é€åˆ°å‰ç«¯
    self.push_progress_to_frontend(task_id, progress_monitor)?;

    Ok(())
}
```

**è°ƒç”¨æ—¶æœº**ï¼š
- æ¯æ‰¹æ¬¡æ•°æ®å¤„ç†å®Œæˆå

### 2. æ‰¹æ¬¡çº§åˆ«è¿›åº¦æ›´æ–°

#### Pipeline è¿›åº¦å›è°ƒ

```rust
// åœ¨ SyncEngine ä¸­
let total_processed = pipeline
    .execute(move |processed, total| {
        // æ¯æ‰¹æ¬¡å¤„ç†å®Œæˆåè§¦å‘
        let unit_name = unit_name_for_progress.clone();
        let task_id = task_id_for_progress.clone();
        let task_manager = task_manager.clone();
        let progress_monitor = progress_monitor.clone();

        // å¼‚æ­¥æ›´æ–°è¿›åº¦ï¼Œä¸é˜»å¡æ•°æ®å¤„ç†
        tokio::spawn(async move {
            if let Err(e) = task_manager
                .update_unit_progress_with_sync(
                    &task_id,
                    &unit_name,
                    total as i64,
                    processed as i64,
                    &progress_monitor,
                )
                .await
            {
                log::error!("æ›´æ–°è¿›åº¦å¤±è´¥: {}", e);
            }
        });
    })
    .await?;
```

**å…³é”®è®¾è®¡**ï¼š
- ä½¿ç”¨ `tokio::spawn` å¼‚æ­¥æ‰§è¡Œæ›´æ–°
- ä¸é˜»å¡æ•°æ®å¤„ç†æµç¨‹
- å³ä½¿æ›´æ–°å¤±è´¥ä¹Ÿä¸å½±å“æ•°æ®åŒæ­¥

### 3. è¿›åº¦èšåˆä¸æ¨é€

#### push_progress_to_frontend

```rust
/// æ¨é€è¿›åº¦åˆ°å‰ç«¯
fn push_progress_to_frontend(
    &self,
    task_id: &str,
    progress_monitor: &Arc<ProgressMonitor>,
) -> Result<()> {
    // ä»å†…å­˜ç¼“å­˜è·å–æ‰€æœ‰ä»»åŠ¡å•å…ƒ
    let units = self.get_task_units(task_id);

    // èšåˆè¿›åº¦
    let total_units = units.len();
    let completed_units = units
        .iter()
        .filter(|u| u.status == TaskUnitStatus::Completed.as_str())
        .count();
    let failed_units = units
        .iter()
        .filter(|u| u.status == TaskUnitStatus::Failed.as_str())
        .count();

    let total_records: u64 = units.iter().map(|u| u.total_records as u64).sum();
    let processed_records: u64 = units.iter().map(|u| u.processed_records as u64).sum();

    let percentage = if total_records > 0 {
        (processed_records as f64 / total_records as f64) * 100.0
    } else {
        0.0
    };

    // æ„å»ºè¿›åº¦å¯¹è±¡
    let progress = TaskProgress {
        task_id: task_id.to_string(),
        status: if completed_units == total_units {
            "completed".to_string()
        } else if failed_units > 0 {
            "failed".to_string()
        } else {
            "running".to_string()
        },
        total_units,
        completed_units,
        failed_units,
        total_records,
        processed_records,
        percentage,
    };

    // æ¨é€åˆ°å‰ç«¯
    progress_monitor.update_progress(progress);

    Ok(())
}
```

**èšåˆé€»è¾‘**ï¼š
- ç»Ÿè®¡æ‰€æœ‰ä»»åŠ¡å•å…ƒçš„çŠ¶æ€
- è®¡ç®—æ€»è®°å½•æ•°å’Œå·²å¤„ç†è®°å½•æ•°
- è‡ªåŠ¨è®¡ç®—å®Œæˆç™¾åˆ†æ¯”
- æ¨é€èšåˆåçš„è¿›åº¦

### 4. ProgressMonitor å®ç°

```rust
/// æ›´æ–°ä»»åŠ¡è¿›åº¦
pub fn update_progress(&self, progress: TaskProgress) {
    let task_id = progress.task_id.clone();

    // 1. æ›´æ–°å†…å­˜ä¸­çš„è¿›åº¦
    {
        let mut map = self.progress_map.write().unwrap();
        map.insert(task_id.clone(), progress.clone());
    }

    // 2. æ¨é€åˆ°å‰ç«¯
    if let Err(e) = self.app_handle.emit("task-progress", &progress) {
        log::error!("æ¨é€è¿›åº¦äº‹ä»¶å¤±è´¥: {}", e);
    }
}
```

**Tauri Event**ï¼š
- äº‹ä»¶å: `"task-progress"`
- æ•°æ®æ ¼å¼: `TaskProgress` (JSON)
- æ¨é€æ–¹å¼: Tauri çš„ `emit` API

---

## ğŸ“¡ å‰ç«¯é›†æˆ

### ç›‘å¬è¿›åº¦äº‹ä»¶

```typescript
import { listen } from '@tauri-apps/api/event';

interface TaskProgress {
  taskId: string;
  status: 'idle' | 'running' | 'completed' | 'failed';
  totalUnits: number;
  completedUnits: number;
  failedUnits: number;
  totalRecords: number;
  processedRecords: number;
  percentage: number;
}

// ç›‘å¬ä»»åŠ¡è¿›åº¦äº‹ä»¶
const unlisten = await listen<TaskProgress>('task-progress', (event) => {
  const progress = event.payload;
  
  console.log(`ä»»åŠ¡ ${progress.taskId}:`);
  console.log(`- çŠ¶æ€: ${progress.status}`);
  console.log(`- å•å…ƒè¿›åº¦: ${progress.completedUnits}/${progress.totalUnits}`);
  console.log(`- è®°å½•è¿›åº¦: ${progress.processedRecords}/${progress.totalRecords}`);
  console.log(`- ç™¾åˆ†æ¯”: ${progress.percentage.toFixed(2)}%`);
  
  // æ›´æ–° UI
  updateTaskProgress(progress);
});

// ç»„ä»¶å¸è½½æ—¶å–æ¶ˆç›‘å¬
onUnmounted(() => {
  unlisten();
});
```

### UI æ›´æ–°ç¤ºä¾‹

```vue
<template>
  <div class="task-progress">
    <div class="progress-header">
      <span>ä»»åŠ¡: {{ taskName }}</span>
      <span>{{ progress.status }}</span>
    </div>
    
    <!-- å•å…ƒè¿›åº¦ -->
    <div class="unit-progress">
      <span>å•å…ƒè¿›åº¦: {{ progress.completedUnits }}/{{ progress.totalUnits }}</span>
      <el-progress 
        :percentage="(progress.completedUnits / progress.totalUnits) * 100"
        :status="progress.status === 'failed' ? 'exception' : undefined"
      />
    </div>
    
    <!-- è®°å½•è¿›åº¦ -->
    <div class="record-progress">
      <span>è®°å½•è¿›åº¦: {{ formatNumber(progress.processedRecords) }}/{{ formatNumber(progress.totalRecords) }}</span>
      <el-progress 
        :percentage="progress.percentage"
        :status="progress.status === 'failed' ? 'exception' : undefined"
      />
    </div>
  </div>
</template>

<script setup lang="ts">
import { ref, onMounted, onUnmounted } from 'vue';
import { listen } from '@tauri-apps/api/event';

const progress = ref<TaskProgress>({
  taskId: '',
  status: 'idle',
  totalUnits: 0,
  completedUnits: 0,
  failedUnits: 0,
  totalRecords: 0,
  processedRecords: 0,
  percentage: 0,
});

let unlisten: (() => void) | null = null;

onMounted(async () => {
  unlisten = await listen<TaskProgress>('task-progress', (event) => {
    if (event.payload.taskId === props.taskId) {
      progress.value = event.payload;
    }
  });
});

onUnmounted(() => {
  unlisten?.();
});

function formatNumber(num: number): string {
  return num.toLocaleString();
}
</script>
```

---

## ğŸ”„ æ•°æ®ä¸€è‡´æ€§ä¿è¯

### åœºæ™¯ 1: æ­£å¸¸æ‰§è¡Œ

```
æ—¶é—´çº¿:
T0: ç”¨æˆ·ç‚¹å‡»"å¼€å§‹åŒæ­¥"
T1: ä»»åŠ¡å•å…ƒ1å¼€å§‹ â†’ æ¨é€äº‹ä»¶ â†’ å‰ç«¯æ˜¾ç¤º "Running"
T2: æ‰¹æ¬¡1å®Œæˆ (2500/10000) â†’ æ¨é€äº‹ä»¶ â†’ å‰ç«¯æ˜¾ç¤º "25%"
T3: æ‰¹æ¬¡2å®Œæˆ (5000/10000) â†’ æ¨é€äº‹ä»¶ â†’ å‰ç«¯æ˜¾ç¤º "50%"
T4: æ‰¹æ¬¡3å®Œæˆ (7500/10000) â†’ æ¨é€äº‹ä»¶ â†’ å‰ç«¯æ˜¾ç¤º "75%"
T5: æ‰¹æ¬¡4å®Œæˆ (10000/10000) â†’ æ¨é€äº‹ä»¶ â†’ å‰ç«¯æ˜¾ç¤º "100%"
T6: ä»»åŠ¡å•å…ƒ1å®Œæˆ â†’ æ¨é€äº‹ä»¶ â†’ å‰ç«¯æ˜¾ç¤º "Completed"

æ•°æ®åº“çŠ¶æ€:
- T1: status='running', processed_records=0
- T2: status='running', processed_records=2500
- T3: status='running', processed_records=5000
- T4: status='running', processed_records=7500
- T5: status='running', processed_records=10000
- T6: status='completed', processed_records=10000

å‰ç«¯æ˜¾ç¤º:
- å®æ—¶æ›´æ–°ï¼Œä¸æ•°æ®åº“ä¸€è‡´
```

### åœºæ™¯ 2: ç”¨æˆ·åˆ·æ–°é¡µé¢

```
æ—¶é—´çº¿:
T0-T3: ä»»åŠ¡æ­£å¸¸æ‰§è¡Œï¼Œè¿›åº¦ 50%
T4: ç”¨æˆ·åˆ·æ–°é¡µé¢
T5: å‰ç«¯é‡æ–°åŠ è½½ï¼Œè°ƒç”¨ get_task_units API
T6: ä»æ•°æ®åº“è¯»å– processed_records=5000
T7: å‰ç«¯æ˜¾ç¤º "50%" âœ… ä¸åˆ·æ–°å‰ä¸€è‡´

ä¿è¯:
- æ•°æ®åº“æ˜¯å”¯ä¸€çš„çœŸå®æ¥æº
- å‰ç«¯åˆ·æ–°åä»æ•°æ®åº“æ¢å¤çŠ¶æ€
- ä¸ä¼šä¸¢å¤±è¿›åº¦ä¿¡æ¯
```

### åœºæ™¯ 3: å¹¶å‘æ‰§è¡Œå¤šä¸ªå•å…ƒ

```
æ—¶é—´çº¿:
T0: 4ä¸ªä»»åŠ¡å•å…ƒå¹¶å‘å¼€å§‹
T1: å•å…ƒ1æ‰¹æ¬¡1å®Œæˆ â†’ æ¨é€äº‹ä»¶ â†’ å‰ç«¯æ›´æ–°
T2: å•å…ƒ2æ‰¹æ¬¡1å®Œæˆ â†’ æ¨é€äº‹ä»¶ â†’ å‰ç«¯æ›´æ–°
T3: å•å…ƒ3æ‰¹æ¬¡1å®Œæˆ â†’ æ¨é€äº‹ä»¶ â†’ å‰ç«¯æ›´æ–°
T4: å•å…ƒ1æ‰¹æ¬¡2å®Œæˆ â†’ æ¨é€äº‹ä»¶ â†’ å‰ç«¯æ›´æ–°
...

èšåˆé€»è¾‘:
- æ¯æ¬¡æ¨é€éƒ½åŒ…å«æ‰€æœ‰å•å…ƒçš„èšåˆè¿›åº¦
- total_records = å•å…ƒ1.total + å•å…ƒ2.total + å•å…ƒ3.total + å•å…ƒ4.total
- processed_records = å•å…ƒ1.processed + å•å…ƒ2.processed + å•å…ƒ3.processed + å•å…ƒ4.processed
- percentage = (processed_records / total_records) * 100

ä¿è¯:
- å¤šçº¿ç¨‹å¹¶å‘æ‰§è¡Œï¼Œè¿›åº¦ç‹¬ç«‹æ›´æ–°
- å‰ç«¯çœ‹åˆ°çš„æ˜¯èšåˆåçš„æ€»è¿›åº¦
- ä¸ä¼šå‡ºç°è¿›åº¦å€’é€€æˆ–è·³è·ƒ
```

---

## ğŸ¯ æ€§èƒ½ä¼˜åŒ–

### 1. å¼‚æ­¥æ›´æ–°

```rust
// ä½¿ç”¨ tokio::spawn å¼‚æ­¥æ›´æ–°ï¼Œä¸é˜»å¡æ•°æ®å¤„ç†
tokio::spawn(async move {
    task_manager.update_unit_progress_with_sync(...).await
});
```

**ä¼˜åŠ¿**ï¼š
- æ•°æ®å¤„ç†å’Œè¿›åº¦æ›´æ–°å¹¶è¡Œæ‰§è¡Œ
- å³ä½¿æ•°æ®åº“å†™å…¥æ…¢ï¼Œä¹Ÿä¸å½±å“æ•°æ®åŒæ­¥é€Ÿåº¦
- æé«˜æ•´ä½“ååé‡

### 2. æ‰¹é‡æ›´æ–°

```rust
// æ¯æ‰¹æ¬¡æ›´æ–°ä¸€æ¬¡ï¼Œè€Œä¸æ˜¯æ¯æ¡è®°å½•æ›´æ–°ä¸€æ¬¡
// batchSize = 2500ï¼Œæ„å‘³ç€æ¯2500æ¡è®°å½•æ¨é€ä¸€æ¬¡
```

**ä¼˜åŠ¿**ï¼š
- å‡å°‘æ•°æ®åº“å†™å…¥æ¬¡æ•°
- å‡å°‘å‰ç«¯äº‹ä»¶æ¨é€æ¬¡æ•°
- é™ä½ç³»ç»Ÿè´Ÿè½½

### 3. å†…å­˜ç¼“å­˜

```rust
// ä½¿ç”¨ RwLock<HashMap> ç¼“å­˜ä»»åŠ¡å•å…ƒçŠ¶æ€
task_units_cache: Arc<RwLock<HashMap<String, Vec<TaskUnit>>>>
```

**ä¼˜åŠ¿**ï¼š
- å¿«é€Ÿè¯»å–ä»»åŠ¡å•å…ƒçŠ¶æ€
- å‡å°‘æ•°æ®åº“æŸ¥è¯¢
- æ”¯æŒé«˜å¹¶å‘è¯»å–

---

## ğŸ“ æœ€ä½³å®è·µ

### 1. é”™è¯¯å¤„ç†

```rust
// è¿›åº¦æ›´æ–°å¤±è´¥ä¸åº”å½±å“æ•°æ®åŒæ­¥
if let Err(e) = task_manager.update_unit_progress_with_sync(...).await {
    log::error!("æ›´æ–°è¿›åº¦å¤±è´¥: {}", e);
    // ç»§ç»­æ‰§è¡Œï¼Œä¸ä¸­æ–­æ•°æ®åŒæ­¥
}
```

### 2. æ—¥å¿—è®°å½•

```rust
log::info!("å¼€å§‹æ‰§è¡Œä»»åŠ¡å•å…ƒ: {}", unit_name);
log::debug!("å•å…ƒ {} è¿›åº¦: {}/{}", unit_name, processed, total);
log::info!("ä»»åŠ¡å•å…ƒæ‰§è¡ŒæˆåŠŸ: {}", unit_name);
log::error!("ä»»åŠ¡å•å…ƒæ‰§è¡Œå¤±è´¥: {}, é”™è¯¯: {}", unit_name, e);
```

### 3. å‰ç«¯é˜²æŠ–

```typescript
// å¦‚æœæ¨é€é¢‘ç‡è¿‡é«˜ï¼Œå‰ç«¯å¯ä»¥ä½¿ç”¨é˜²æŠ–
import { debounce } from 'lodash-es';

const updateProgress = debounce((progress: TaskProgress) => {
  // æ›´æ–° UI
}, 100); // 100ms é˜²æŠ–

listen('task-progress', (event) => {
  updateProgress(event.payload);
});
```

---

## ğŸ” æ•…éšœæ’æŸ¥

### é—®é¢˜ 1: å‰ç«¯æ”¶ä¸åˆ°è¿›åº¦äº‹ä»¶

**å¯èƒ½åŸå› **ï¼š
1. å‰ç«¯æ²¡æœ‰æ­£ç¡®ç›‘å¬ `task-progress` äº‹ä»¶
2. Tauri Event æ¨é€å¤±è´¥

**æ’æŸ¥æ­¥éª¤**ï¼š
1. æ£€æŸ¥å‰ç«¯ç›‘å¬ä»£ç 
2. æŸ¥çœ‹åç«¯æ—¥å¿—ï¼š`æ¨é€è¿›åº¦äº‹ä»¶å¤±è´¥`
3. æ£€æŸ¥ Tauri é…ç½®

### é—®é¢˜ 2: è¿›åº¦ä¸æ›´æ–°

**å¯èƒ½åŸå› **ï¼š
1. æ•°æ®åº“å†™å…¥å¤±è´¥
2. å†…å­˜ç¼“å­˜æœªæ›´æ–°
3. Pipeline è¿›åº¦å›è°ƒæœªè§¦å‘

**æ’æŸ¥æ­¥éª¤**ï¼š
1. æŸ¥çœ‹åç«¯æ—¥å¿—ï¼š`æ›´æ–°è¿›åº¦å¤±è´¥`
2. æ£€æŸ¥æ•°æ®åº“ `task_units` è¡¨
3. æ£€æŸ¥ Pipeline æ‰§è¡Œé€»è¾‘

### é—®é¢˜ 3: å‰ç«¯åˆ·æ–°åè¿›åº¦ä¸¢å¤±

**å¯èƒ½åŸå› **ï¼š
1. æ•°æ®åº“æœªæŒä¹…åŒ–
2. å‰ç«¯æœªä»æ•°æ®åº“åŠ è½½

**æ’æŸ¥æ­¥éª¤**ï¼š
1. æ£€æŸ¥ `update_unit_progress_with_sync` æ˜¯å¦è°ƒç”¨
2. æ£€æŸ¥æ•°æ®åº“ `task_units` è¡¨æ•°æ®
3. æ£€æŸ¥å‰ç«¯åŠ è½½é€»è¾‘

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [ä»»åŠ¡ç®¡ç†å™¨è®¾è®¡](../features/ä»»åŠ¡ç®¡ç†å™¨.md) - ä»»åŠ¡ç®¡ç†å™¨æ ¸å¿ƒåŠŸèƒ½
- [æ•°æ®äº¤æ¢æ¡†æ¶è®¾è®¡](../architecture/æ•°æ®äº¤æ¢æ¡†æ¶è®¾è®¡.md) - Exchange Framework
- [ä»»åŠ¡è°ƒåº¦ä¸æ–­ç‚¹ç»­ä¼ ](../features/ä»»åŠ¡è°ƒåº¦ä¸æ–­ç‚¹ç»­ä¼ .md) - è°ƒåº¦ç­–ç•¥
- [æ•°æ®åº“è®¾è®¡](../architecture/æ•°æ®åº“è®¾è®¡.md) - æ•°æ®åº“è¡¨ç»“æ„

---

**æ–‡æ¡£ç»´æŠ¤**: DataTrac å¼€å‘å›¢é˜Ÿ  
**æœ€åæ›´æ–°**: 2026-01-30
