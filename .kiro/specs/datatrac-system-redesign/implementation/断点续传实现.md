# æ–­ç‚¹ç»­ä¼ å®ç°

## ğŸ“‹ æ–‡æ¡£è¯´æ˜

æœ¬æ–‡æ¡£è¯¦ç»†æè¿°æ–­ç‚¹ç»­ä¼ åŠŸèƒ½çš„å®ç°ç»†èŠ‚å’Œä»£ç é€»è¾‘ã€‚

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**æœ€åæ›´æ–°**: 2026-01-30  
**å®ç°çŠ¶æ€**: âœ… å·²å®Œæˆ

---

## ğŸ¯ æ¦‚è¿°

æ–­ç‚¹ç»­ä¼ åŠŸèƒ½ç¡®ä¿ä»»åŠ¡åœ¨æš‚åœã€æ–­ç½‘ã€å´©æºƒåèƒ½å¤Ÿç»§ç»­æ‰§è¡Œï¼Œé¿å…é‡å¤åŒæ­¥å·²å®Œæˆçš„æ•°æ®ã€‚

**æ ¸å¿ƒç‰¹æ€§**:
- ä»¥è¡¨/ç´¢å¼•ä¸ºå•ä½è®°å½•è¿›åº¦
- æ•°æ®åº“æŒä¹…åŒ–ä¿è¯çŠ¶æ€ä¸ä¸¢å¤±
- æ”¯æŒä»»åŠ¡æš‚åœã€æ¢å¤ã€é‡å¯
- å·²å®Œæˆå•å…ƒä¸é‡å¤æ‰§è¡Œ

---

## ğŸ—ï¸ ä¸‰è¡¨ç»“æ„

### è¡¨å…³ç³»

```
sync_tasks (ä»»åŠ¡ä¸»è¡¨)
   â†“ 1:N
task_unit_configs (é…ç½®è¡¨)
   â†“ 1:1
task_unit_runtimes (è¿è¡Œè®°å½•è¡¨)
```

### è¡¨ä½œç”¨

| è¡¨å | ä½œç”¨ | æ•°æ®ç‰¹ç‚¹ |
|------|------|---------|
| sync_tasks | å­˜å‚¨ä»»åŠ¡åŸºæœ¬ä¿¡æ¯ | ç›¸å¯¹ç¨³å®š |
| task_unit_configs | å­˜å‚¨è¦åŒæ­¥çš„è¡¨/ç´¢å¼•åˆ—è¡¨ | é…ç½®å˜æ›´æ—¶æ›´æ–° |
| task_unit_runtimes | å­˜å‚¨æ‰§è¡ŒçŠ¶æ€å’Œè¿›åº¦ | é¢‘ç¹æ›´æ–° |

---

## ğŸ“ åˆå§‹åŒ–æµç¨‹

### å®Œæ•´æµç¨‹å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. ç”¨æˆ·å¯åŠ¨ä»»åŠ¡                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. TaskLoader::init_task_units                               â”‚
â”‚    â””â”€ åˆå§‹åŒ–ä»»åŠ¡å•å…ƒï¼ˆæ”¯æŒæ–­ç‚¹ç»­ä¼ ï¼‰                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. ä» task_unit_configs è¯»å–é…ç½®                             â”‚
â”‚    â””â”€ è·å–è¦åŒæ­¥çš„è¡¨/ç´¢å¼•åˆ—è¡¨                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. ä» task_unit_runtimes åŠ è½½ç°æœ‰è¿è¡Œè®°å½•                    â”‚
â”‚    â””â”€ æ„å»º HashMap<unit_name, runtime>                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. å¯¹æ¯”é…ç½®å’Œè¿è¡Œè®°å½•                                        â”‚
â”‚    â”œâ”€ å·²æœ‰è®°å½• â†’ æ ¹æ®çŠ¶æ€å¤„ç†                                â”‚
â”‚    â”‚   â”œâ”€ Completed â†’ ä¿æŒä¸å˜                              â”‚
â”‚    â”‚   â”œâ”€ Running â†’ é‡ç½®ä¸º Pending                          â”‚
â”‚    â”‚   â””â”€ å…¶ä»– â†’ ä¿æŒä¸å˜                                    â”‚
â”‚    â””â”€ æ— è®°å½• â†’ åˆ›å»ºæ–°è®°å½•ï¼ˆPendingï¼‰                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 6. æ¸…ç†å­¤ç«‹çš„è¿è¡Œè®°å½•                                        â”‚
â”‚    â””â”€ åˆ é™¤é…ç½®è¡¨ä¸­ä¸å­˜åœ¨çš„è¿è¡Œè®°å½•                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 7. åˆå§‹åŒ–å®Œæˆ                                                â”‚
â”‚    â””â”€ è¿”å›ç»Ÿè®¡ä¿¡æ¯                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”§ æ ¸å¿ƒå®ç°ä»£ç 

### TaskLoader::init_task_units

```rust
pub async fn init_task_units(&self, task_id: &str) -> Result<()> {
    log::info!("[init_task_units] åˆå§‹åŒ–ä»»åŠ¡å•å…ƒ: task_id={}", task_id);
    
    let storage = self.source_manager.storage();
    
    // 1. ä»é…ç½®è¡¨è¯»å–æ‰€æœ‰å•å…ƒ
    let configs = storage.load_unit_configs(task_id).await?;
    
    if configs.is_empty() {
        anyhow::bail!("é…ç½®è¡¨ä¸­æ²¡æœ‰æ‰¾åˆ°ä»»åŠ¡å•å…ƒï¼Œè¯·å…ˆä¿å­˜ä»»åŠ¡é…ç½®");
    }
    
    log::info!("[init_task_units] ä»é…ç½®è¡¨åŠ è½½åˆ° {} ä¸ªå•å…ƒ", configs.len());
    
    // 2. åŠ è½½ç°æœ‰çš„è¿è¡Œè®°å½•
    let existing_runtimes = storage.load_unit_runtimes(task_id).await?;
    let runtime_map: std::collections::HashMap<String, _> = existing_runtimes
        .into_iter()
        .map(|r| (r.unit_name.clone(), r))
        .collect();
    
    log::info!("[init_task_units] ç°æœ‰è¿è¡Œè®°å½•: {} ä¸ª", runtime_map.len());
    
    // 3. ä¸ºæ¯ä¸ªé…ç½®å•å…ƒåˆ›å»ºæˆ–ä¿æŒè¿è¡Œè®°å½•
    let now = chrono::Utc::now().timestamp_millis();
    for config in &configs {
        if let Some(existing) = runtime_map.get(&config.unit_name) {
            // å·²æœ‰è¿è¡Œè®°å½•
            match existing.status {
                TaskUnitStatus::Running => {
                    // è¿è¡Œä¸­çŠ¶æ€é‡ç½®ä¸º pendingï¼ˆå¯èƒ½æ˜¯å¼‚å¸¸ä¸­æ–­ï¼‰
                    log::info!("[init_task_units] å•å…ƒ {} è¿è¡Œä¸­è¢«ä¸­æ–­ï¼Œé‡ç½®ä¸º pending", 
                        config.unit_name);
                    storage.reset_runtime(task_id, &config.unit_name).await?;
                }
                TaskUnitStatus::Pending | TaskUnitStatus::Failed => {
                    // pending å’Œ failed çŠ¶æ€ä¿æŒä¸å˜
                    log::info!("[init_task_units] å•å…ƒ {} çŠ¶æ€ä¸º {:?}ï¼Œä¿æŒä¸å˜", 
                        config.unit_name, existing.status);
                }
                TaskUnitStatus::Completed => {
                    // å·²å®Œæˆï¼Œä¿æŒä¸å˜
                    log::info!("[init_task_units] å•å…ƒ {} å·²å®Œæˆï¼Œè·³è¿‡", 
                        config.unit_name);
                }
                _ => {}
            }
        } else {
            // æ²¡æœ‰è¿è¡Œè®°å½•ï¼Œåˆ›å»ºæ–°çš„
            log::info!("[init_task_units] åˆ›å»ºæ–°çš„è¿è¡Œè®°å½•: {}", config.unit_name);
            let runtime = TaskUnitRuntime {
                id: uuid::Uuid::new_v4().to_string(),
                task_id: task_id.to_string(),
                unit_name: config.unit_name.clone(),
                status: TaskUnitStatus::Pending,
                total_records: 0,
                processed_records: 0,
                error_message: None,
                started_at: None,
                updated_at: now,
                last_processed_batch: None,
            };
            storage.save_unit_runtime(&runtime).await?;
        }
    }
    
    // 4. æ¸…ç†é…ç½®è¡¨ä¸­ä¸å­˜åœ¨çš„è¿è¡Œè®°å½•
    let cleaned = storage.cleanup_orphan_runtimes(task_id).await?;
    if cleaned > 0 {
        log::info!("[init_task_units] æ¸…ç†äº† {} ä¸ªå­¤ç«‹çš„è¿è¡Œè®°å½•", cleaned);
    }
    
    // 5. ç»Ÿè®¡çŠ¶æ€
    let runtimes = storage.load_unit_runtimes(task_id).await?;
    let pending_count = runtimes.iter()
        .filter(|r| r.status == TaskUnitStatus::Pending)
        .count();
    let failed_count = runtimes.iter()
        .filter(|r| r.status == TaskUnitStatus::Failed)
        .count();
    let completed_count = runtimes.iter()
        .filter(|r| r.status == TaskUnitStatus::Completed)
        .count();
    
    log::info!("[init_task_units] ä»»åŠ¡å•å…ƒåˆå§‹åŒ–å®Œæˆï¼Œå…± {} ä¸ªå•å…ƒ", runtimes.len());
    log::info!("[init_task_units] çŠ¶æ€ç»Ÿè®¡: å¾…æ‰§è¡Œ={}, å¤±è´¥={}, å·²å®Œæˆ={}", 
        pending_count, failed_count, completed_count);
    
    Ok(())
}
```

---

## ğŸ“Š çŠ¶æ€å¤„ç†é€»è¾‘

### çŠ¶æ€è½¬æ¢è¡¨

| åŸçŠ¶æ€ | ä»»åŠ¡é‡å¯å | è¯´æ˜ |
|--------|-----------|------|
| Completed | Completed | ä¿æŒä¸å˜ï¼Œä¸ä¼šé‡æ–°æ‰§è¡Œ |
| Pending | Pending | ä¿æŒä¸å˜ï¼Œç­‰å¾…æ‰§è¡Œ |
| Running | Pending | é‡ç½®ä¸º Pendingï¼Œé‡æ–°æ‰§è¡Œ |
| Failed | Failed | ä¿æŒä¸å˜ï¼Œç­‰å¾…æ‰‹åŠ¨é‡ç½® |
| Paused | Pending | é‡ç½®ä¸º Pendingï¼Œé‡æ–°æ‰§è¡Œ |

### ä»£ç å®ç°

```rust
match existing.status {
    TaskUnitStatus::Completed => {
        // å·²å®Œæˆï¼Œä¿æŒä¸å˜
        // ä¸åšä»»ä½•æ“ä½œ
    }
    TaskUnitStatus::Running => {
        // è¿è¡Œä¸­è¢«ä¸­æ–­ï¼Œé‡ç½®ä¸º pending
        storage.reset_runtime(task_id, &config.unit_name).await?;
    }
    TaskUnitStatus::Pending | TaskUnitStatus::Failed => {
        // ä¿æŒä¸å˜
        // ä¸åšä»»ä½•æ“ä½œ
    }
    TaskUnitStatus::Paused => {
        // é‡ç½®ä¸º pending
        storage.reset_runtime(task_id, &config.unit_name).await?;
    }
}
```

---

## ğŸ”„ ä½¿ç”¨åœºæ™¯

### åœºæ™¯ 1: æ­£å¸¸æš‚åœæ¢å¤

```
åˆå§‹çŠ¶æ€:
- ç´¢å¼•A: Completed (100%)
- ç´¢å¼•B: Running (50%)
- ç´¢å¼•C: Pending (0%)

ç”¨æˆ·æš‚åœä»»åŠ¡
   â†“
çŠ¶æ€å˜åŒ–:
- ç´¢å¼•A: Completed
- ç´¢å¼•B: Paused (50%)
- ç´¢å¼•C: Pending

ç”¨æˆ·æ¢å¤ä»»åŠ¡
   â†“
init_task_units æ‰§è¡Œ
   â†“
çŠ¶æ€å˜åŒ–:
- ç´¢å¼•A: Completed (ä¿æŒ)
- ç´¢å¼•B: Pending (é‡ç½®)
- ç´¢å¼•C: Pending (ä¿æŒ)

è‡ªåŠ¨æ¨¡å¼æ‰§è¡Œ
   â†“
æ‰§è¡Œç»“æœ:
- ç´¢å¼•A: ä¸æ‰§è¡Œï¼ˆå·²å®Œæˆï¼‰
- ç´¢å¼•B: ä»å¤´å¼€å§‹
- ç´¢å¼•C: ä»å¤´å¼€å§‹
```

### åœºæ™¯ 2: å¼‚å¸¸ä¸­æ–­æ¢å¤

```
åˆå§‹çŠ¶æ€:
- ç´¢å¼•A: Completed (100%)
- ç´¢å¼•B: Running (80%)
- ç´¢å¼•C: Running (30%)

ç¨‹åºå´©æºƒ
   â†“
é‡æ–°å¯åŠ¨ç¨‹åº
   â†“
ç”¨æˆ·å¯åŠ¨ä»»åŠ¡
   â†“
init_task_units æ‰§è¡Œ
   â†“
çŠ¶æ€å˜åŒ–:
- ç´¢å¼•A: Completed (ä¿æŒ)
- ç´¢å¼•B: Pending (é‡ç½®)
- ç´¢å¼•C: Pending (é‡ç½®)

è‡ªåŠ¨æ¨¡å¼æ‰§è¡Œ
   â†“
æ‰§è¡Œç»“æœ:
- ç´¢å¼•A: ä¸æ‰§è¡Œï¼ˆå·²å®Œæˆï¼‰
- ç´¢å¼•B: ä»å¤´å¼€å§‹
- ç´¢å¼•C: ä»å¤´å¼€å§‹
```

### åœºæ™¯ 3: å¤±è´¥é‡è¯•

```
åˆå§‹çŠ¶æ€:
- ç´¢å¼•A: Completed (100%)
- ç´¢å¼•B: Failed (ç½‘ç»œé”™è¯¯)
- ç´¢å¼•C: Pending (0%)

ç”¨æˆ·é‡ç½®å¤±è´¥å•å…ƒ
   â†“
è°ƒç”¨ reset_failed_units API
   â†“
çŠ¶æ€å˜åŒ–:
- ç´¢å¼•A: Completed
- ç´¢å¼•B: Pending (é‡ç½®)
- ç´¢å¼•C: Pending

ç”¨æˆ·é‡æ–°å¯åŠ¨ä»»åŠ¡
   â†“
init_task_units æ‰§è¡Œ
   â†“
çŠ¶æ€ä¿æŒ:
- ç´¢å¼•A: Completed
- ç´¢å¼•B: Pending
- ç´¢å¼•C: Pending

è‡ªåŠ¨æ¨¡å¼æ‰§è¡Œ
   â†“
æ‰§è¡Œç»“æœ:
- ç´¢å¼•A: ä¸æ‰§è¡Œï¼ˆå·²å®Œæˆï¼‰
- ç´¢å¼•B: é‡æ–°æ‰§è¡Œ
- ç´¢å¼•C: æ‰§è¡Œ
```

---

## ğŸ—„ï¸ æ•°æ®åº“æ“ä½œ

### åŠ è½½é…ç½®

```rust
// Storage::load_unit_configs
pub async fn load_unit_configs(&self, task_id: &str) -> Result<Vec<TaskUnitConfig>> {
    let mut conn = self.pool.acquire().await?;
    
    let configs = sqlx::query_as::<_, TaskUnitConfig>(
        "SELECT * FROM task_unit_configs WHERE task_id = ? ORDER BY unit_name"
    )
    .bind(task_id)
    .fetch_all(&mut *conn)
    .await?;
    
    Ok(configs)
}
```

### åŠ è½½è¿è¡Œè®°å½•

```rust
// Storage::load_unit_runtimes
pub async fn load_unit_runtimes(&self, task_id: &str) -> Result<Vec<TaskUnitRuntime>> {
    let mut conn = self.pool.acquire().await?;
    
    let runtimes = sqlx::query_as::<_, TaskUnitRuntime>(
        "SELECT * FROM task_unit_runtimes WHERE task_id = ? ORDER BY unit_name"
    )
    .bind(task_id)
    .fetch_all(&mut *conn)
    .await?;
    
    Ok(runtimes)
}
```

### é‡ç½®è¿è¡Œè®°å½•

```rust
// Storage::reset_runtime
pub async fn reset_runtime(&self, task_id: &str, unit_name: &str) -> Result<()> {
    let mut conn = self.pool.acquire().await?;
    let now = chrono::Utc::now().timestamp_millis();
    
    sqlx::query(
        "UPDATE task_unit_runtimes 
         SET status = 'pending', 
             processed_records = 0, 
             error_message = NULL,
             started_at = NULL,
             updated_at = ?
         WHERE task_id = ? AND unit_name = ?"
    )
    .bind(now)
    .bind(task_id)
    .bind(unit_name)
    .execute(&mut *conn)
    .await?;
    
    Ok(())
}
```

### æ¸…ç†å­¤ç«‹è®°å½•

```rust
// Storage::cleanup_orphan_runtimes
pub async fn cleanup_orphan_runtimes(&self, task_id: &str) -> Result<u64> {
    let mut conn = self.pool.acquire().await?;
    
    let result = sqlx::query(
        "DELETE FROM task_unit_runtimes 
         WHERE task_id = ? 
         AND unit_name NOT IN (
             SELECT unit_name FROM task_unit_configs WHERE task_id = ?
         )"
    )
    .bind(task_id)
    .bind(task_id)
    .execute(&mut *conn)
    .await?;
    
    Ok(result.rows_affected())
}
```

---

## ğŸ¯ è®¾è®¡ä¼˜åŠ¿

### 1. é…ç½®ä¸è¿è¡Œåˆ†ç¦»
- é…ç½®è¡¨å­˜å‚¨ä¸å˜çš„é…ç½®
- è¿è¡Œè®°å½•è¡¨å­˜å‚¨å¯å˜çš„çŠ¶æ€
- æ”¯æŒé‡ç½®è¿è¡Œè®°å½•è€Œä¸å½±å“é…ç½®

### 2. æ•°æ®ä¸€è‡´æ€§
- å¤–é”®çº¦æŸä¿è¯å¼•ç”¨å®Œæ•´æ€§
- å”¯ä¸€çº¦æŸé˜²æ­¢é‡å¤æ•°æ®
- äº‹åŠ¡ä¿è¯åŸå­æ€§æ“ä½œ

### 3. çµæ´»çš„çŠ¶æ€ç®¡ç†
- æ”¯æŒå¤šç§çŠ¶æ€
- æ”¯æŒçŠ¶æ€è½¬æ¢
- æ”¯æŒçŠ¶æ€é‡ç½®

### 4. å¯é çš„æ–­ç‚¹ç»­ä¼ 
- æ•°æ®åº“æŒä¹…åŒ–
- æ”¯æŒå¼‚å¸¸æ¢å¤
- å·²å®Œæˆå•å…ƒä¸é‡å¤æ‰§è¡Œ

---

## ğŸ’¡ æœ€ä½³å®è·µ

### 1. åˆå§‹åŒ–æ—¶æœº
- æ¯æ¬¡ä»»åŠ¡å¯åŠ¨æ—¶è°ƒç”¨ `init_task_units`
- ç¡®ä¿è¿è¡Œè®°å½•ä¸é…ç½®åŒæ­¥
- æ¸…ç†å­¤ç«‹çš„è¿è¡Œè®°å½•

### 2. çŠ¶æ€æ›´æ–°
- ä½¿ç”¨ `update_unit_status_with_sync` åŒæ­¥æ›´æ–°
- ç¡®ä¿å†…å­˜ã€æ•°æ®åº“ã€å‰ç«¯ä¸€è‡´
- åŠæ—¶æ›´æ–°è¿›åº¦ä¿¡æ¯

### 3. é”™è¯¯å¤„ç†
- å¤±è´¥å•å…ƒæ ‡è®°ä¸º Failed
- è®°å½•è¯¦ç»†é”™è¯¯ä¿¡æ¯
- æ”¯æŒæ‰‹åŠ¨é‡ç½®é‡è¯•

### 4. æ€§èƒ½ä¼˜åŒ–
- æ‰¹é‡åŠ è½½è¿è¡Œè®°å½•
- ä½¿ç”¨ HashMap å¿«é€ŸæŸ¥æ‰¾
- å‡å°‘æ•°æ®åº“å¾€è¿”

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [ä»»åŠ¡è°ƒåº¦ä¸æ–­ç‚¹ç»­ä¼ ](../features/ä»»åŠ¡è°ƒåº¦ä¸æ–­ç‚¹ç»­ä¼ .md) - åŠŸèƒ½è®¾è®¡
- [æ•°æ®åº“è®¾è®¡](../architecture/æ•°æ®åº“è®¾è®¡.md) - ä¸‰è¡¨ç»“æ„è®¾è®¡
- [ä»»åŠ¡ç®¡ç†å™¨å®ç°](./ä»»åŠ¡ç®¡ç†å™¨å®ç°.md) - TaskManager å®ç°
- [è‡ªåŠ¨æ¨¡å¼å®ç°](./è‡ªåŠ¨æ¨¡å¼å®ç°.md) - è‡ªåŠ¨æ¨¡å¼æ‰§è¡Œæµç¨‹

---

**æ–‡æ¡£ç»´æŠ¤**: DataTrac å¼€å‘å›¢é˜Ÿ  
**æœ€åæ›´æ–°**: 2026-01-30
