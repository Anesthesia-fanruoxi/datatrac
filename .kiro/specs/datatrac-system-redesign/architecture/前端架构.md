# å‰ç«¯æ¶æ„

## ğŸ“‹ æ–‡æ¡£è¯´æ˜

æœ¬æ–‡æ¡£è¯¦ç»†æè¿° DataTrac å‰ç«¯çš„æ¶æ„è®¾è®¡ã€ç›®å½•ç»“æ„å’ŒæŠ€æœ¯è§„èŒƒã€‚

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**æœ€åæ›´æ–°**: 2026-01-30

---

## ğŸ¯ æŠ€æœ¯æ ˆ

### æ ¸å¿ƒæ¡†æ¶
- **Vue 3.4+** - æ¸è¿›å¼ JavaScript æ¡†æ¶
- **TypeScript 5.0+** - ç±»å‹å®‰å…¨
- **Vite 5.0+** - æ„å»ºå·¥å…·

### UI æ¡†æ¶
- **Naive UI** - Vue 3 ç»„ä»¶åº“
- **@vicons** - å›¾æ ‡åº“

### çŠ¶æ€ç®¡ç†
- **Pinia** - Vue 3 å®˜æ–¹çŠ¶æ€ç®¡ç†åº“

### è·¯ç”±
- **Vue Router 4** - å®˜æ–¹è·¯ç”±åº“

### é€šä¿¡
- **@tauri-apps/api** - Tauri IPC é€šä¿¡

### å·¥å…·åº“
- **dayjs** - æ—¥æœŸå¤„ç†
- **lodash-es** - å·¥å…·å‡½æ•°

---

## ğŸ“ ç›®å½•ç»“æ„

```
src/
â”œâ”€â”€ main.ts                     # åº”ç”¨å…¥å£
â”œâ”€â”€ App.vue                     # æ ¹ç»„ä»¶
â”œâ”€â”€ vite-env.d.ts              # Vite ç±»å‹å£°æ˜
â”œâ”€â”€ router/                     # è·¯ç”±é…ç½®
â”‚   â””â”€â”€ index.ts
â”œâ”€â”€ stores/                     # Pinia çŠ¶æ€ç®¡ç†
â”‚   â”œâ”€â”€ index.ts               # Store å…¥å£
â”‚   â”œâ”€â”€ datasource.ts          # æ•°æ®æº Store
â”‚   â”œâ”€â”€ task.ts                # ä»»åŠ¡ Store
â”‚   â””â”€â”€ monitor.ts             # ç›‘æ§ Store
â”œâ”€â”€ api/                        # API è°ƒç”¨å±‚
â”‚   â”œâ”€â”€ datasource.ts          # æ•°æ®æº API
â”‚   â”œâ”€â”€ task.ts                # ä»»åŠ¡ API
â”‚   â””â”€â”€ monitor.ts             # ç›‘æ§ API
â”œâ”€â”€ types/                      # ç±»å‹å®šä¹‰
â”‚   â””â”€â”€ index.ts               # ç»Ÿä¸€å¯¼å‡º
â”œâ”€â”€ utils/                      # å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ message.ts             # æ¶ˆæ¯æç¤º
â”‚   â”œâ”€â”€ format.ts              # æ ¼å¼åŒ–å‡½æ•°
â”‚   â””â”€â”€ validate.ts            # éªŒè¯å‡½æ•°
â”œâ”€â”€ components/                 # ç»„ä»¶
â”‚   â”œâ”€â”€ common/                # é€šç”¨ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ Button.vue
â”‚   â”‚   â”œâ”€â”€ Dialog.vue
â”‚   â”‚   â””â”€â”€ Loading.vue
â”‚   â””â”€â”€ SyncTaskWizard/        # ä»»åŠ¡é…ç½®å‘å¯¼
â”‚       â”œâ”€â”€ index.vue          # ä¸»ç»„ä»¶
â”‚       â”œâ”€â”€ TaskHeader.vue     # ä»»åŠ¡å¤´éƒ¨
â”‚       â”œâ”€â”€ StepIndicator.vue  # æ­¥éª¤æŒ‡ç¤ºå™¨
â”‚       â”œâ”€â”€ Step1SelectDataSourceType.vue
â”‚       â”œâ”€â”€ Step2SelectDataSource.vue
â”‚       â”œâ”€â”€ Step3SelectUnits.vue
â”‚       â”œâ”€â”€ Step4SyncConfig.vue
â”‚       â”œâ”€â”€ Step5Confirm.vue
â”‚       â””â”€â”€ shared/            # å…±äº«ç»„ä»¶
â”‚           â”œâ”€â”€ DataSourceSelector.vue
â”‚           â””â”€â”€ SyncConfigForm.vue
â”œâ”€â”€ views/                      # é¡µé¢è§†å›¾
â”‚   â”œâ”€â”€ DataSourceManagement.vue  # æ•°æ®æºç®¡ç†
â”‚   â”œâ”€â”€ SyncTaskConfig.vue        # ä»»åŠ¡é…ç½®
â”‚   â”œâ”€â”€ TaskMonitor.vue           # ä»»åŠ¡ç›‘æ§
â”‚   â””â”€â”€ TaskMonitor/              # ä»»åŠ¡ç›‘æ§å­ç»„ä»¶
â”‚       â”œâ”€â”€ components/
â”‚       â”‚   â”œâ”€â”€ TaskList.vue      # ä»»åŠ¡å•å…ƒåˆ—è¡¨
â”‚       â”‚   â”œâ”€â”€ ProgressPanel.vue # è¿›åº¦é¢æ¿
â”‚       â”‚   â”œâ”€â”€ LogPanel.vue      # æ—¥å¿—é¢æ¿
â”‚       â”‚   â””â”€â”€ TaskControl.vue   # ä»»åŠ¡æ§åˆ¶
â”‚       â””â”€â”€ composables/
â”‚           â””â”€â”€ useTaskMonitor.ts # ç›‘æ§é€»è¾‘
â””â”€â”€ assets/                     # é™æ€èµ„æº
    â”œâ”€â”€ styles/                # æ ·å¼æ–‡ä»¶
    â”‚   â”œâ”€â”€ main.css          # å…¨å±€æ ·å¼
    â”‚   â””â”€â”€ variables.css     # CSS å˜é‡
    â””â”€â”€ images/               # å›¾ç‰‡èµ„æº
```

---

## ğŸ—ï¸ åˆ†å±‚æ¶æ„

### æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Views (é¡µé¢è§†å›¾)                      â”‚
â”‚  - é¡µé¢çº§åˆ«çš„ UI æ¸²æŸ“                                    â”‚
â”‚  - ç»„ç»‡é¡µé¢å¸ƒå±€                                          â”‚
â”‚  - è°ƒç”¨ Composables å’Œ Stores                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“ ä½¿ç”¨
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 Components (ç»„ä»¶)                        â”‚
â”‚  - å¯å¤ç”¨çš„ UI ç»„ä»¶                                      â”‚
â”‚  - æ¥æ”¶ propsï¼Œè§¦å‘ events                              â”‚
â”‚  - æ— çŠ¶æ€æˆ–å±€éƒ¨çŠ¶æ€                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“ ä½¿ç”¨
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Composables (ç»„åˆå¼å‡½æ•°)                    â”‚
â”‚  - å°è£…ä¸šåŠ¡é€»è¾‘                                          â”‚
â”‚  - å¯å¤ç”¨çš„çŠ¶æ€é€»è¾‘                                      â”‚
â”‚  - è°ƒç”¨ Stores å’Œ API                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“ ä½¿ç”¨
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Stores (çŠ¶æ€ç®¡ç†)                       â”‚
â”‚  - å…¨å±€çŠ¶æ€ç®¡ç†                                          â”‚
â”‚  - ç¼“å­˜æ•°æ®                                              â”‚
â”‚  - è°ƒç”¨ API å±‚                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“ ä½¿ç”¨
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   API Layer (API å±‚)                     â”‚
â”‚  - å°è£… Tauri Command è°ƒç”¨                              â”‚
â”‚  - ç±»å‹å®‰å…¨çš„æ¥å£                                        â”‚
â”‚  - é”™è¯¯å¤„ç†                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“ è°ƒç”¨
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                Tauri IPC (åç«¯é€šä¿¡)                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“¦ æ¨¡å—è®¾è®¡

### 1. API å±‚

**èŒè´£**:
- å°è£…æ‰€æœ‰ Tauri Command è°ƒç”¨
- æä¾›ç±»å‹å®‰å…¨çš„æ¥å£
- ç»Ÿä¸€é”™è¯¯å¤„ç†

**ç¤ºä¾‹**:
```typescript
// src/api/datasource.ts
import { invoke } from '@tauri-apps/api/core';
import type { DataSource, CreateDataSourceRequest } from '../types';

export const datasourceApi = {
  async list(): Promise<DataSource[]> {
    try {
      return await invoke('list_data_sources');
    } catch (error) {
      console.error('Failed to list data sources:', error);
      throw error;
    }
  },
  
  async create(data: CreateDataSourceRequest): Promise<DataSource> {
    return await invoke('create_data_source', { data });
  },
  
  // ... å…¶ä»–æ–¹æ³•
};
```

### 2. Store å±‚

**èŒè´£**:
- ç®¡ç†å…¨å±€çŠ¶æ€
- ç¼“å­˜æ•°æ®
- æä¾›çŠ¶æ€æ“ä½œæ–¹æ³•

**ç¤ºä¾‹**:
```typescript
// src/stores/datasource.ts
import { defineStore } from 'pinia';
import { ref, computed } from 'vue';
import { datasourceApi } from '../api/datasource';

export const useDataSourceStore = defineStore('datasource', () => {
  // çŠ¶æ€
  const dataSources = ref<DataSource[]>([]);
  const loading = ref(false);
  const error = ref<string | null>(null);
  
  // è®¡ç®—å±æ€§
  const mysqlDataSources = computed(() => 
    dataSources.value.filter(ds => ds.type === 'mysql')
  );
  
  // æ–¹æ³•
  async function fetchDataSources() {
    loading.value = true;
    error.value = null;
    try {
      dataSources.value = await datasourceApi.list();
    } catch (e: any) {
      error.value = e.message;
      throw e;
    } finally {
      loading.value = false;
    }
  }
  
  return {
    dataSources,
    loading,
    error,
    mysqlDataSources,
    fetchDataSources,
  };
});
```

### 3. Composables å±‚

**èŒè´£**:
- å°è£…å¯å¤ç”¨çš„ä¸šåŠ¡é€»è¾‘
- ç»„åˆå¤šä¸ª Store
- å¤„ç†å¤æ‚çš„çŠ¶æ€é€»è¾‘

**ç¤ºä¾‹**:
```typescript
// src/views/TaskMonitor/composables/useTaskMonitor.ts
import { ref, onMounted, onUnmounted } from 'vue';
import { useMonitorStore } from '@/stores/monitor';
import { listen } from '@tauri-apps/api/event';

export function useTaskMonitor(taskId: string) {
  const monitorStore = useMonitorStore();
  const progress = ref<TaskProgress | null>(null);
  let unlisten: (() => void) | null = null;
  
  // å¯åŠ¨ç›‘å¬
  async function startListening() {
    unlisten = await listen<TaskProgress>('task-progress', (event) => {
      if (event.payload.taskId === taskId) {
        progress.value = event.payload;
      }
    });
  }
  
  // åœæ­¢ç›‘å¬
  function stopListening() {
    if (unlisten) {
      unlisten();
      unlisten = null;
    }
  }
  
  onMounted(() => {
    startListening();
  });
  
  onUnmounted(() => {
    stopListening();
  });
  
  return {
    progress,
    startTask: () => monitorStore.startTask(taskId),
    pauseTask: () => monitorStore.pauseTask(taskId),
    stopTask: () => monitorStore.stopTask(taskId),
  };
}
```

### 4. ç»„ä»¶å±‚

**èŒè´£**:
- å¯å¤ç”¨çš„ UI ç»„ä»¶
- æ¥æ”¶ propsï¼Œè§¦å‘ events
- æ— çŠ¶æ€æˆ–å±€éƒ¨çŠ¶æ€

**ç»„ä»¶åˆ†ç±»**:

**é€šç”¨ç»„ä»¶** (`components/common/`):
- æŒ‰é’®ã€è¾“å…¥æ¡†ã€å¯¹è¯æ¡†ç­‰
- å®Œå…¨æ— ä¸šåŠ¡é€»è¾‘
- é«˜åº¦å¯å¤ç”¨

**ä¸šåŠ¡ç»„ä»¶** (`components/`):
- åŒ…å«ç‰¹å®šä¸šåŠ¡é€»è¾‘
- å¯èƒ½è°ƒç”¨ Store æˆ– API
- åœ¨ç‰¹å®šåœºæ™¯ä½¿ç”¨

**ç¤ºä¾‹**:
```vue
<!-- src/components/common/Button.vue -->
<template>
  <button
    :class="['custom-button', `custom-button--${type}`]"
    :disabled="disabled || loading"
    @click="handleClick"
  >
    <span v-if="loading" class="loading-icon">â³</span>
    <slot />
  </button>
</template>

<script setup lang="ts">
interface Props {
  type?: 'primary' | 'default' | 'danger';
  disabled?: boolean;
  loading?: boolean;
}

const props = withDefaults(defineProps<Props>(), {
  type: 'default',
  disabled: false,
  loading: false,
});

const emit = defineEmits<{
  click: [];
}>();

function handleClick() {
  if (!props.disabled && !props.loading) {
    emit('click');
  }
}
</script>
```

### 5. é¡µé¢å±‚

**èŒè´£**:
- é¡µé¢çº§åˆ«çš„ UI æ¸²æŸ“
- ç»„ç»‡é¡µé¢å¸ƒå±€
- è°ƒç”¨ Composables å’Œ Stores

**ç¤ºä¾‹**:
```vue
<!-- src/views/TaskMonitor.vue -->
<template>
  <div class="task-monitor">
    <TaskControl
      :task-id="taskId"
      :status="progress?.status"
      @start="handleStart"
      @pause="handlePause"
      @stop="handleStop"
    />
    
    <ProgressPanel
      :progress="progress"
      :task-units="taskUnits"
    />
    
    <LogPanel
      :logs="logs"
    />
  </div>
</template>

<script setup lang="ts">
import { useRoute } from 'vue-router';
import { useTaskMonitor } from './composables/useTaskMonitor';
import TaskControl from './components/TaskControl.vue';
import ProgressPanel from './components/ProgressPanel.vue';
import LogPanel from './components/LogPanel.vue';

const route = useRoute();
const taskId = route.params.id as string;

const {
  progress,
  taskUnits,
  logs,
  startTask,
  pauseTask,
  stopTask,
} = useTaskMonitor(taskId);

async function handleStart() {
  await startTask();
}

async function handlePause() {
  await pauseTask();
}

async function handleStop() {
  await stopTask();
}
</script>
```

---

## ğŸ¨ æ ·å¼ç»„ç»‡

### CSS å˜é‡

```css
/* src/assets/styles/variables.css */
:root {
  /* é¢œè‰² */
  --color-primary: #18a058;
  --color-success: #18a058;
  --color-warning: #f0a020;
  --color-error: #d03050;
  --color-info: #2080f0;
  
  /* é—´è· */
  --spacing-xs: 4px;
  --spacing-sm: 8px;
  --spacing-md: 16px;
  --spacing-lg: 24px;
  --spacing-xl: 32px;
  
  /* å­—ä½“ */
  --font-size-sm: 12px;
  --font-size-md: 14px;
  --font-size-lg: 16px;
  --font-size-xl: 18px;
  
  /* åœ†è§’ */
  --border-radius-sm: 2px;
  --border-radius-md: 4px;
  --border-radius-lg: 8px;
}
```

### æ ·å¼è§„èŒƒ

1. **ä½¿ç”¨ scoped æ ·å¼**
   ```vue
   <style scoped>
   .component { ... }
   </style>
   ```

2. **ä½¿ç”¨ CSS å˜é‡**
   ```css
   .button {
     padding: var(--spacing-md);
     border-radius: var(--border-radius-md);
   }
   ```

3. **BEM å‘½åè§„èŒƒ**
   ```css
   .block { }
   .block__element { }
   .block--modifier { }
   ```

---

## ğŸ”§ å·¥å…·å‡½æ•°

### æ¶ˆæ¯æç¤º

```typescript
// src/utils/message.ts
import { useMessage } from 'naive-ui';

let message: ReturnType<typeof useMessage> | null = null;

export function setupMessage() {
  message = useMessage();
}

export function showSuccess(text: string) {
  message?.success(text);
}

export function showError(text: string) {
  message?.error(text);
}

export function showWarning(text: string) {
  message?.warning(text);
}
```

### æ ¼å¼åŒ–å‡½æ•°

```typescript
// src/utils/format.ts
import dayjs from 'dayjs';

export function formatDate(date: string | number): string {
  return dayjs(date).format('YYYY-MM-DD HH:mm:ss');
}

export function formatFileSize(bytes: number): string {
  if (bytes === 0) return '0 B';
  const k = 1024;
  const sizes = ['B', 'KB', 'MB', 'GB'];
  const i = Math.floor(Math.log(bytes) / Math.log(k));
  return `${(bytes / Math.pow(k, i)).toFixed(2)} ${sizes[i]}`;
}

export function formatNumber(num: number): string {
  return num.toLocaleString('zh-CN');
}
```

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [æŠ€æœ¯è§„èŒƒ](./æŠ€æœ¯è§„èŒƒ.md) - å‰åç«¯ç»Ÿä¸€è§„èŒƒ
- [APIæ¥å£è®¾è®¡](./APIæ¥å£è®¾è®¡.md) - API æ¥å£æ–‡æ¡£
- [UIè®¾è®¡](../design/UIè®¾è®¡.md) - UI è®¾è®¡è§„èŒƒ
- [äº¤äº’è®¾è®¡](../design/äº¤äº’è®¾è®¡.md) - äº¤äº’æµç¨‹

---

**æ–‡æ¡£ç»´æŠ¤**: DataTrac å¼€å‘å›¢é˜Ÿ  
**æœ€åæ›´æ–°**: 2026-01-30
