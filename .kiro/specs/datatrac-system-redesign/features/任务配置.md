# ä»»åŠ¡é…ç½®

## ğŸ“‹ æ–‡æ¡£è¯´æ˜

æœ¬æ–‡æ¡£è¯¦ç»†æè¿°ä»»åŠ¡é…ç½®å‘å¯¼çš„ä¸šåŠ¡é€»è¾‘å’Œå®ç°ç»†èŠ‚ã€‚

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**æœ€åæ›´æ–°**: 2026-01-30  
**å®ç°çŠ¶æ€**: âœ… å·²å®Œæˆ

---

## ğŸ¯ æ¦‚è¿°

ä»»åŠ¡é…ç½®æ¨¡å—é‡‡ç”¨å‘å¯¼å¼ç•Œé¢ï¼Œå¼•å¯¼ç”¨æˆ·ä¸€æ­¥æ­¥å®ŒæˆåŒæ­¥ä»»åŠ¡çš„é…ç½®ã€‚

**æ ¸å¿ƒåŠŸèƒ½**:
- 5 æ­¥å‘å¯¼å¼é…ç½®
- æ”¯æŒ 4 ç§åŒæ­¥æ–¹å‘
- è‡ªåŠ¨ç”Ÿæˆä»»åŠ¡å•å…ƒé…ç½®
- é…ç½®éªŒè¯å’Œé¢„è§ˆ

---

## ğŸ”„ é…ç½®æµç¨‹

### æ•´ä½“æµç¨‹å›¾

```
æ­¥éª¤ 1: é€‰æ‹©æ•°æ®æºç±»å‹
   â†“
æ­¥éª¤ 2: é€‰æ‹©æ•°æ®æº
   â†“
æ­¥éª¤ 3: é€‰æ‹©è¡¨/ç´¢å¼•
   â†“
æ­¥éª¤ 4: é…ç½®åŒæ­¥å‚æ•°
   â†“
æ­¥éª¤ 5: ç¡®è®¤å¹¶ä¿å­˜
   â†“
ç”Ÿæˆä»»åŠ¡å•å…ƒé…ç½®
   â†“
ä¿å­˜åˆ°æ•°æ®åº“
```

---

## ğŸ“ æ­¥éª¤è¯¦è§£

### æ­¥éª¤ 1: é€‰æ‹©æ•°æ®æºç±»å‹

#### ä¸šåŠ¡é€»è¾‘

**ç›®çš„**: ç¡®å®šåŒæ­¥æ–¹å‘

**å¯é€‰ç»„åˆ**:
1. MySQL â†’ Elasticsearch
2. Elasticsearch â†’ MySQL
3. MySQL â†’ MySQL
4. Elasticsearch â†’ Elasticsearch

**æ•°æ®ç»“æ„**:
```typescript
interface DataSourceTypeSelection {
  sourceType: 'mysql' | 'elasticsearch';
  targetType: 'mysql' | 'elasticsearch';
}
```

**éªŒè¯è§„åˆ™**:
- å¿…é¡»é€‰æ‹©ä¸€ç§ç»„åˆ

**çŠ¶æ€ç®¡ç†**:
```typescript
const wizardState = ref({
  step: 1,
  sourceType: null,
  targetType: null,
  // ... å…¶ä»–æ­¥éª¤çš„æ•°æ®
});
```

---

### æ­¥éª¤ 2: é€‰æ‹©æ•°æ®æº

#### ä¸šåŠ¡é€»è¾‘

**ç›®çš„**: é€‰æ‹©æºæ•°æ®æºå’Œç›®æ ‡æ•°æ®æº

**æ•°æ®åŠ è½½**:
```typescript
// åŠ è½½å¯¹åº”ç±»å‹çš„æ•°æ®æºåˆ—è¡¨
const sourceDataSources = computed(() => {
  return dataSources.value.filter(ds => ds.type === wizardState.value.sourceType);
});

const targetDataSources = computed(() => {
  return dataSources.value.filter(ds => ds.type === wizardState.value.targetType);
});
```

**éªŒè¯è§„åˆ™**:
- æºæ•°æ®æºå¿…é€‰
- ç›®æ ‡æ•°æ®æºå¿…é€‰
- æºå’Œç›®æ ‡ä¸èƒ½æ˜¯åŒä¸€ä¸ªæ•°æ®æº

**éªŒè¯ä»£ç **:
```typescript
function validateStep2() {
  if (!wizardState.value.sourceId) {
    throw new Error('è¯·é€‰æ‹©æºæ•°æ®æº');
  }
  if (!wizardState.value.targetId) {
    throw new Error('è¯·é€‰æ‹©ç›®æ ‡æ•°æ®æº');
  }
  if (wizardState.value.sourceId === wizardState.value.targetId) {
    throw new Error('æºæ•°æ®æºå’Œç›®æ ‡æ•°æ®æºä¸èƒ½ç›¸åŒ');
  }
}
```

**å¿«é€Ÿåˆ›å»ºæ•°æ®æº**:
- å¦‚æœæ²¡æœ‰å¯ç”¨æ•°æ®æºï¼Œæä¾›"å¿«é€Ÿåˆ›å»º"é“¾æ¥
- æ‰“å¼€æ•°æ®æºåˆ›å»ºå¯¹è¯æ¡†
- åˆ›å»ºæˆåŠŸåè‡ªåŠ¨é€‰ä¸­æ–°æ•°æ®æº

---

### æ­¥éª¤ 3: é€‰æ‹©è¡¨/ç´¢å¼•

#### 3.1 MySQL è¡¨é€‰æ‹©

**ä¸šåŠ¡é€»è¾‘**:

```
åŠ è½½æ•°æ®åº“åˆ—è¡¨
   â†“
ç”¨æˆ·é€‰æ‹©æ•°æ®åº“
   â†“
åŠ è½½è¯¥æ•°æ®åº“çš„è¡¨åˆ—è¡¨
   â†“
ç”¨æˆ·é€‰æ‹©è¡¨ï¼ˆæ”¯æŒå¤šé€‰ï¼‰
   â†“
ä¿å­˜é€‰æ‹©ç»“æœ
```

**æ•°æ®ç»“æ„**:
```typescript
interface MySQLSelection {
  databases: Array<{
    database: string;
    tables: string[];
  }>;
}
```

**å®ç°ä»£ç **:
```typescript
// åŠ è½½æ•°æ®åº“åˆ—è¡¨
async function loadDatabases() {
  loading.value = true;
  try {
    databases.value = await invoke('get_databases', {
      dataSourceId: wizardState.value.sourceId
    });
  } finally {
    loading.value = false;
  }
}

// åŠ è½½è¡¨åˆ—è¡¨
async function loadTables(database: string) {
  loading.value = true;
  try {
    const tables = await invoke('get_tables', {
      dataSourceId: wizardState.value.sourceId,
      database
    });
    tableMap.value.set(database, tables);
  } finally {
    loading.value = false;
  }
}

// é€‰æ‹©è¡¨
function selectTables(database: string, tables: string[]) {
  const existing = wizardState.value.mysqlConfig.databases.find(
    d => d.database === database
  );
  
  if (existing) {
    existing.tables = tables;
  } else {
    wizardState.value.mysqlConfig.databases.push({
      database,
      tables
    });
  }
}
```

**UI äº¤äº’**:
- å·¦ä¾§ï¼šæ•°æ®åº“åˆ—è¡¨ï¼ˆå¯å±•å¼€/æŠ˜å ï¼‰
- å³ä¾§ï¼šè¡¨åˆ—è¡¨ï¼ˆå¤é€‰æ¡†å¤šé€‰ï¼‰
- æ”¯æŒæœç´¢è¿‡æ»¤
- æ˜¾ç¤ºå·²é€‰æ‹©æ•°é‡

**éªŒè¯è§„åˆ™**:
- è‡³å°‘é€‰æ‹©ä¸€ä¸ªè¡¨

#### 3.2 ES ç´¢å¼•é€‰æ‹©

**ä¸šåŠ¡é€»è¾‘**:

```
åŠ è½½ç´¢å¼•åˆ—è¡¨
   â†“
æ˜¾ç¤ºç´¢å¼•ä¿¡æ¯ï¼ˆåç§°ã€æ–‡æ¡£æ•°ã€å¤§å°ï¼‰
   â†“
ç”¨æˆ·ç­›é€‰ç´¢å¼•
   â”œâ”€ æŒ‰åç§°æœç´¢
   â”œâ”€ æŒ‰å‰ç¼€ç­›é€‰
   â””â”€ æŒ‰æ—¥æœŸèŒƒå›´ç­›é€‰
   â†“
ç”¨æˆ·é€‰æ‹©ç´¢å¼•ï¼ˆæ”¯æŒå¤šé€‰ï¼‰
   â†“
ä¿å­˜é€‰æ‹©ç»“æœ
```

**æ•°æ®ç»“æ„**:
```typescript
interface ESSelection {
  selectedIndices: string[];
  indices?: Array<{
    name: string;
    docsCount: number;
    storeSize: string;
  }>;
}
```

**å®ç°ä»£ç **:
```typescript
// åŠ è½½ç´¢å¼•åˆ—è¡¨
async function loadIndices() {
  loading.value = true;
  try {
    const indices = await invoke('get_indices', {
      dataSourceId: wizardState.value.sourceId
    });
    wizardState.value.esConfig.indices = indices;
  } finally {
    loading.value = false;
  }
}

// ç­›é€‰ç´¢å¼•
const filteredIndices = computed(() => {
  let result = wizardState.value.esConfig.indices || [];
  
  // æŒ‰åç§°æœç´¢
  if (searchText.value) {
    result = result.filter(idx => 
      idx.name.toLowerCase().includes(searchText.value.toLowerCase())
    );
  }
  
  // æŒ‰å‰ç¼€ç­›é€‰
  if (prefixFilter.value) {
    result = result.filter(idx => 
      idx.name.startsWith(prefixFilter.value)
    );
  }
  
  // æŒ‰æ—¥æœŸèŒƒå›´ç­›é€‰
  if (dateRange.value) {
    result = result.filter(idx => {
      const date = extractDateFromIndexName(idx.name);
      return date >= dateRange.value.start && date <= dateRange.value.end;
    });
  }
  
  return result;
});

// é€‰æ‹©ç´¢å¼•
function selectIndices(indices: string[]) {
  wizardState.value.esConfig.selectedIndices = indices;
}
```

**UI äº¤äº’**:
- é¡¶éƒ¨ï¼šç­›é€‰åŒºåŸŸ
- ä¸­éƒ¨ï¼šç´¢å¼•åˆ—è¡¨ï¼ˆå¤é€‰æ¡†å¤šé€‰ï¼‰
- åº•éƒ¨ï¼šå·²é€‰æ‹©æ•°é‡å’Œå…¨é€‰/å–æ¶ˆå…¨é€‰æŒ‰é’®

**éªŒè¯è§„åˆ™**:
- è‡³å°‘é€‰æ‹©ä¸€ä¸ªç´¢å¼•

---

### æ­¥éª¤ 4: é…ç½®åŒæ­¥å‚æ•°

#### ä¸šåŠ¡é€»è¾‘

**é…ç½®é¡¹**:

1. **æ‰¹æ¬¡å¤§å° (batchSize)**
   - è¯´æ˜ï¼šæ¯æ‰¹æ¬¡åŒæ­¥çš„è®°å½•æ•°
   - èŒƒå›´ï¼š100 - 10000
   - é»˜è®¤å€¼ï¼š2500
   - å½±å“ï¼šæ‰¹æ¬¡è¶Šå¤§ï¼Œé€Ÿåº¦è¶Šå¿«ï¼Œä½†å†…å­˜å ç”¨è¶Šé«˜

2. **çº¿ç¨‹æ•° (threadCount)**
   - è¯´æ˜ï¼šå¹¶å‘æ‰§è¡Œçš„çº¿ç¨‹æ•°
   - èŒƒå›´ï¼š1 - 20
   - é»˜è®¤å€¼ï¼š4
   - å½±å“ï¼šçº¿ç¨‹è¶Šå¤šï¼Œé€Ÿåº¦è¶Šå¿«ï¼Œä½†èµ„æºå ç”¨è¶Šé«˜

3. **é”™è¯¯ç­–ç•¥ (errorStrategy)**
   - é€‰é¡¹ï¼š
     - `skip`: è·³è¿‡é”™è¯¯ï¼Œç»§ç»­æ‰§è¡Œ
     - `pause`: é‡åˆ°é”™è¯¯æ—¶æš‚åœä»»åŠ¡
   - é»˜è®¤å€¼ï¼šskip

4. **è¡¨å­˜åœ¨ç­–ç•¥ (tableExistsStrategy)** - ä»… MySQL ç›®æ ‡
   - é€‰é¡¹ï¼š
     - `drop`: åˆ é™¤é‡å»ºè¡¨
     - `truncate`: æ¸…ç©ºè¡¨æ•°æ®
     - `backup`: å¤‡ä»½ååˆ é™¤é‡å»º
   - é»˜è®¤å€¼ï¼šdrop

5. **æ•°æ®åº“åç§°è½¬æ¢ (dbNameTransform)** - ä»… MySQLâ†’MySQL
   - å¯ç”¨/ç¦ç”¨
   - è½¬æ¢æ¨¡å¼ï¼šå‰ç¼€/åç¼€
   - æºæ¨¡å¼ï¼šæ­£åˆ™è¡¨è¾¾å¼
   - ç›®æ ‡æ¨¡å¼ï¼šæ›¿æ¢å­—ç¬¦ä¸²

**æ•°æ®ç»“æ„**:
```typescript
interface SyncConfig {
  batchSize: number;
  threadCount: number;
  errorStrategy: 'skip' | 'pause';
  tableExistsStrategy: 'drop' | 'truncate' | 'backup';
  dbNameTransform?: {
    enabled: boolean;
    mode: 'prefix' | 'suffix';
    sourcePattern: string;
    targetPattern: string;
  };
}
```

**å®ç°ä»£ç **:
```typescript
// åˆå§‹åŒ–é»˜è®¤é…ç½®
const defaultSyncConfig: SyncConfig = {
  batchSize: 2500,
  threadCount: 4,
  errorStrategy: 'skip',
  tableExistsStrategy: 'drop',
};

// æ¢å¤é»˜è®¤å€¼
function resetToDefault() {
  wizardState.value.syncConfig = { ...defaultSyncConfig };
}

// éªŒè¯é…ç½®
function validateSyncConfig() {
  const config = wizardState.value.syncConfig;
  
  if (config.batchSize < 100 || config.batchSize > 10000) {
    throw new Error('æ‰¹æ¬¡å¤§å°å¿…é¡»åœ¨ 100-10000 ä¹‹é—´');
  }
  
  if (config.threadCount < 1 || config.threadCount > 20) {
    throw new Error('çº¿ç¨‹æ•°å¿…é¡»åœ¨ 1-20 ä¹‹é—´');
  }
  
  if (config.dbNameTransform?.enabled) {
    if (!config.dbNameTransform.sourcePattern) {
      throw new Error('è¯·è¾“å…¥æºæ¨¡å¼');
    }
    if (!config.dbNameTransform.targetPattern) {
      throw new Error('è¯·è¾“å…¥ç›®æ ‡æ¨¡å¼');
    }
  }
}
```

**UI äº¤äº’**:
- ä½¿ç”¨æ•°å­—è¾“å…¥æ¡†ï¼ˆå¸¦èŒƒå›´é™åˆ¶ï¼‰
- ä½¿ç”¨å•é€‰æŒ‰é’®ç»„
- æä¾›"æ¢å¤é»˜è®¤å€¼"æŒ‰é’®
- æ¯ä¸ªé…ç½®é¡¹æä¾›è¯´æ˜æ–‡å­—

---

### æ­¥éª¤ 5: ç¡®è®¤å¹¶ä¿å­˜

#### ä¸šåŠ¡é€»è¾‘

**æ˜¾ç¤ºå†…å®¹**:
1. ä»»åŠ¡åç§°è¾“å…¥æ¡†
2. æ•°æ®æºä¿¡æ¯ï¼ˆåªè¯»ï¼‰
3. é€‰æ‹©çš„è¡¨/ç´¢å¼•åˆ—è¡¨ï¼ˆåªè¯»ï¼‰
4. åŒæ­¥å‚æ•°ï¼ˆåªè¯»ï¼‰

**æ•°æ®ç»“æ„**:
```typescript
interface TaskConfirmation {
  taskName: string;
  sourceInfo: {
    name: string;
    type: string;
    host: string;
  };
  targetInfo: {
    name: string;
    type: string;
    host: string;
  };
  selectedUnits: string[];
  syncConfig: SyncConfig;
}
```

**éªŒè¯è§„åˆ™**:
- ä»»åŠ¡åç§°å¿…å¡«
- ä»»åŠ¡åç§° 2-50 å­—ç¬¦
- ä»»åŠ¡åç§°ä¸èƒ½é‡å¤

**ä¿å­˜é€»è¾‘**:

```typescript
async function saveTask() {
  // 1. éªŒè¯ä»»åŠ¡åç§°
  if (!taskName.value) {
    throw new Error('è¯·è¾“å…¥ä»»åŠ¡åç§°');
  }
  
  if (taskName.value.length < 2 || taskName.value.length > 50) {
    throw new Error('ä»»åŠ¡åç§°é•¿åº¦åº”åœ¨ 2-50 å­—ç¬¦ä¹‹é—´');
  }
  
  // 2. æ£€æŸ¥åç§°å”¯ä¸€æ€§
  const existing = await invoke('find_task_by_name', { name: taskName.value });
  if (existing) {
    throw new Error('ä»»åŠ¡åç§°å·²å­˜åœ¨');
  }
  
  // 3. æ„å»ºä»»åŠ¡é…ç½®
  const taskConfig = {
    name: taskName.value,
    sourceId: wizardState.value.sourceId,
    targetId: wizardState.value.targetId,
    sourceType: wizardState.value.sourceType,
    targetType: wizardState.value.targetType,
    config: JSON.stringify({
      mysqlConfig: wizardState.value.mysqlConfig,
      esConfig: wizardState.value.esConfig,
      syncConfig: wizardState.value.syncConfig,
    }),
    status: 'idle',
    syncMode: 'auto',
  };
  
  // 4. ä¿å­˜ä»»åŠ¡
  loading.value = true;
  try {
    const task = await invoke('create_sync_task', { data: taskConfig });
    
    // 5. ç”Ÿæˆä»»åŠ¡å•å…ƒé…ç½®
    await generateTaskUnitConfigs(task.id);
    
    // 6. æ˜¾ç¤ºæˆåŠŸæç¤º
    message.success('ä»»åŠ¡åˆ›å»ºæˆåŠŸ');
    
    // 7. è·³è½¬åˆ°ä»»åŠ¡åˆ—è¡¨
    router.push('/tasks');
  } finally {
    loading.value = false;
  }
}
```

---

## ğŸ”§ ä»»åŠ¡å•å…ƒé…ç½®ç”Ÿæˆ

### ç”Ÿæˆé€»è¾‘

**ç›®çš„**: ä»ä»»åŠ¡é…ç½®ä¸­æå–è¦åŒæ­¥çš„è¡¨/ç´¢å¼•åˆ—è¡¨ï¼Œä¿å­˜åˆ° `task_unit_configs` è¡¨

**æµç¨‹**:

```
è¯»å–ä»»åŠ¡é…ç½®
   â†“
æ ¹æ®åŒæ­¥æ–¹å‘æå–å•å…ƒåˆ—è¡¨
   â”œâ”€ MySQL: databases[].tables
   â””â”€ ES: selectedIndices
   â†“
ä¸ºæ¯ä¸ªå•å…ƒåˆ›å»ºé…ç½®è®°å½•
   â”œâ”€ ç”Ÿæˆ UUID
   â”œâ”€ è®¾ç½® unit_name
   â”œâ”€ è®¾ç½® unit_type (table/index)
   â””â”€ å…³è” task_id
   â†“
æ‰¹é‡ä¿å­˜åˆ°æ•°æ®åº“
```

**å®ç°ä»£ç **:

```typescript
async function generateTaskUnitConfigs(taskId: string) {
  const configs: TaskUnitConfig[] = [];
  
  // MySQL æº
  if (wizardState.value.sourceType === 'mysql') {
    for (const db of wizardState.value.mysqlConfig.databases) {
      for (const table of db.tables) {
        configs.push({
          id: generateUUID(),
          taskId,
          unitName: `${db.database}.${table}`,
          unitType: 'table',
          createdAt: Date.now(),
        });
      }
    }
  }
  
  // ES æº
  if (wizardState.value.sourceType === 'elasticsearch') {
    for (const index of wizardState.value.esConfig.selectedIndices) {
      configs.push({
        id: generateUUID(),
        taskId,
        unitName: index,
        unitType: 'index',
        createdAt: Date.now(),
      });
    }
  }
  
  // æ‰¹é‡ä¿å­˜
  await invoke('save_task_unit_configs', { configs });
}
```

**åç«¯å®ç°**:

```rust
#[tauri::command]
pub async fn save_task_unit_configs(
    configs: Vec<TaskUnitConfig>,
    state: State<'_, AppState>,
) -> Result<(), String> {
    let storage = &state.storage;
    
    for config in configs {
        storage.save_unit_config(&config).await
            .map_err(|e| format!("ä¿å­˜å¤±è´¥: {}", e))?;
    }
    
    Ok(())
}
```

---

## ğŸ“Š çŠ¶æ€ç®¡ç†

### Wizard State

```typescript
interface WizardState {
  // å½“å‰æ­¥éª¤
  step: number;
  
  // æ­¥éª¤ 1
  sourceType: 'mysql' | 'elasticsearch' | null;
  targetType: 'mysql' | 'elasticsearch' | null;
  
  // æ­¥éª¤ 2
  sourceId: string | null;
  targetId: string | null;
  
  // æ­¥éª¤ 3
  mysqlConfig: {
    databases: Array<{
      database: string;
      tables: string[];
    }>;
  };
  esConfig: {
    indices?: Array<{
      name: string;
      docsCount: number;
      storeSize: string;
    }>;
    selectedIndices: string[];
  };
  
  // æ­¥éª¤ 4
  syncConfig: {
    batchSize: number;
    threadCount: number;
    errorStrategy: 'skip' | 'pause';
    tableExistsStrategy: 'drop' | 'truncate' | 'backup';
    dbNameTransform?: {
      enabled: boolean;
      mode: 'prefix' | 'suffix';
      sourcePattern: string;
      targetPattern: string;
    };
  };
  
  // æ­¥éª¤ 5
  taskName: string;
}
```

### æ­¥éª¤å¯¼èˆª

```typescript
// ä¸‹ä¸€æ­¥
function nextStep() {
  // éªŒè¯å½“å‰æ­¥éª¤
  validateCurrentStep();
  
  // è¿›å…¥ä¸‹ä¸€æ­¥
  wizardState.value.step++;
}

// ä¸Šä¸€æ­¥
function prevStep() {
  wizardState.value.step--;
}

// è·³è½¬åˆ°æŒ‡å®šæ­¥éª¤
function goToStep(step: number) {
  // éªŒè¯ä¹‹å‰çš„æ‰€æœ‰æ­¥éª¤
  for (let i = 1; i < step; i++) {
    validateStep(i);
  }
  
  wizardState.value.step = step;
}

// éªŒè¯å½“å‰æ­¥éª¤
function validateCurrentStep() {
  switch (wizardState.value.step) {
    case 1:
      validateStep1();
      break;
    case 2:
      validateStep2();
      break;
    case 3:
      validateStep3();
      break;
    case 4:
      validateStep4();
      break;
    case 5:
      validateStep5();
      break;
  }
}
```

---

## ğŸ¨ UI ç»„ä»¶ç»“æ„

### ç»„ä»¶å±‚æ¬¡

```
SyncTaskWizard (ä¸»ç»„ä»¶)
  â”œâ”€ TaskHeader (ä»»åŠ¡å¤´éƒ¨)
  â”œâ”€ StepIndicator (æ­¥éª¤æŒ‡ç¤ºå™¨)
  â”œâ”€ Step1SelectDataSourceType (æ­¥éª¤ 1)
  â”œâ”€ Step2SelectDataSource (æ­¥éª¤ 2)
  â”œâ”€ Step3SelectUnits (æ­¥éª¤ 3)
  â”‚   â”œâ”€ MySQLTableSelector (MySQL è¡¨é€‰æ‹©å™¨)
  â”‚   â””â”€ ESIndexSelector (ES ç´¢å¼•é€‰æ‹©å™¨)
  â”œâ”€ Step4SyncConfig (æ­¥éª¤ 4)
  â”œâ”€ Step5Confirm (æ­¥éª¤ 5)
  â””â”€ WizardFooter (åº•éƒ¨æŒ‰é’®)
```

### ç»„ä»¶é€šä¿¡

```typescript
// ä½¿ç”¨ provide/inject å…±äº«çŠ¶æ€
provide('wizardState', wizardState);
provide('nextStep', nextStep);
provide('prevStep', prevStep);

// å­ç»„ä»¶ä¸­ä½¿ç”¨
const wizardState = inject('wizardState');
const nextStep = inject('nextStep');
```

---

## ğŸ”„ ç¼–è¾‘ä»»åŠ¡

### ç¼–è¾‘æµç¨‹

```
ç”¨æˆ·ç‚¹å‡»"ç¼–è¾‘ä»»åŠ¡"
   â†“
åŠ è½½ä»»åŠ¡é…ç½®
   â†“
è§£æé…ç½® JSON
   â†“
å¡«å…… Wizard State
   â†“
è¿›å…¥å‘å¯¼ï¼ˆå¯è·³è½¬åˆ°ä»»æ„æ­¥éª¤ï¼‰
   â†“
ç”¨æˆ·ä¿®æ”¹é…ç½®
   â†“
ä¿å­˜æ›´æ–°
   â”œâ”€ æ›´æ–°ä»»åŠ¡ä¸»è¡¨
   â”œâ”€ åˆ é™¤æ—§çš„ä»»åŠ¡å•å…ƒé…ç½®
   â””â”€ ç”Ÿæˆæ–°çš„ä»»åŠ¡å•å…ƒé…ç½®
```

### å®ç°ä»£ç 

```typescript
async function loadTaskForEdit(taskId: string) {
  // 1. åŠ è½½ä»»åŠ¡
  const task = await invoke('get_sync_task', { id: taskId });
  
  // 2. è§£æé…ç½®
  const config = JSON.parse(task.config);
  
  // 3. å¡«å……çŠ¶æ€
  wizardState.value = {
    step: 1,
    sourceType: task.sourceType,
    targetType: task.targetType,
    sourceId: task.sourceId,
    targetId: task.targetId,
    mysqlConfig: config.mysqlConfig || { databases: [] },
    esConfig: config.esConfig || { selectedIndices: [] },
    syncConfig: config.syncConfig,
    taskName: task.name,
  };
  
  // 4. æ ‡è®°ä¸ºç¼–è¾‘æ¨¡å¼
  isEditMode.value = true;
  editingTaskId.value = taskId;
}

async function updateTask() {
  // 1. æ„å»ºæ›´æ–°æ•°æ®
  const updateData = {
    name: taskName.value,
    config: JSON.stringify({
      mysqlConfig: wizardState.value.mysqlConfig,
      esConfig: wizardState.value.esConfig,
      syncConfig: wizardState.value.syncConfig,
    }),
  };
  
  // 2. æ›´æ–°ä»»åŠ¡
  await invoke('update_sync_task', {
    id: editingTaskId.value,
    data: updateData,
  });
  
  // 3. åˆ é™¤æ—§çš„ä»»åŠ¡å•å…ƒé…ç½®
  await invoke('delete_task_unit_configs', {
    taskId: editingTaskId.value,
  });
  
  // 4. ç”Ÿæˆæ–°çš„ä»»åŠ¡å•å…ƒé…ç½®
  await generateTaskUnitConfigs(editingTaskId.value);
  
  // 5. æ˜¾ç¤ºæˆåŠŸæç¤º
  message.success('ä»»åŠ¡æ›´æ–°æˆåŠŸ');
  
  // 6. è·³è½¬åˆ°ä»»åŠ¡åˆ—è¡¨
  router.push('/tasks');
}
```

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [äº¤äº’è®¾è®¡](../design/äº¤äº’è®¾è®¡.md) - ä»»åŠ¡é…ç½®äº¤äº’æµç¨‹
- [æ•°æ®åº“è®¾è®¡](../architecture/æ•°æ®åº“è®¾è®¡.md) - ä»»åŠ¡è¡¨å’Œä»»åŠ¡å•å…ƒé…ç½®è¡¨
- [APIæ¥å£è®¾è®¡](../architecture/APIæ¥å£è®¾è®¡.md) - ä»»åŠ¡é…ç½®ç›¸å…³ API
- [æ•°æ®æºç®¡ç†](./æ•°æ®æºç®¡ç†.md) - æ•°æ®æºæŸ¥è¯¢æ¥å£

---

**æ–‡æ¡£ç»´æŠ¤**: DataTrac å¼€å‘å›¢é˜Ÿ  
**æœ€åæ›´æ–°**: 2026-01-30
