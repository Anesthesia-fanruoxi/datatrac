# 交互设计

## 📋 文档说明

本文档详细描述 DataTrac 系统的用户交互流程、操作规范和反馈机制。

**文档版本**: v1.0  
**最后更新**: 2026-01-30

---

## 🎯 设计原则

### 1. 简单易用
- 操作流程清晰，步骤明确
- 减少用户思考时间
- 提供合理的默认值

### 2. 及时反馈
- 操作后立即给予反馈
- 加载状态清晰可见
- 错误信息明确具体

### 3. 容错性强
- 重要操作需要二次确认
- 支持撤销和重试
- 友好的错误提示

### 4. 一致性
- 相同操作使用相同交互方式
- 统一的视觉反馈
- 统一的术语和文案

---

## 🔄 核心交互流程

### 1. 数据源管理流程

#### 1.1 创建数据源

```
用户点击"添加数据源"按钮
   ↓
弹出数据源配置对话框
   ↓
用户选择数据源类型（MySQL/ES）
   ↓
表单显示对应类型的配置项
   ↓
用户填写配置信息
   ├─ 实时验证（必填项、格式）
   └─ 显示验证错误提示
   ↓
用户点击"测试连接"按钮（可选）
   ├─ 显示加载状态
   ├─ 成功 → 显示成功提示
   └─ 失败 → 显示错误信息
   ↓
用户点击"保存"按钮
   ├─ 验证所有字段
   ├─ 显示加载状态
   ├─ 成功 → 关闭对话框，刷新列表，显示成功提示
   └─ 失败 → 显示错误信息，保持对话框打开
```

**交互要点**:
- 表单验证实时进行
- 测试连接是可选操作
- 密码字段默认隐藏，可点击眼睛图标显示
- 保存前再次验证所有字段

#### 1.2 编辑数据源

```
用户点击数据源列表中的"编辑"按钮
   ↓
弹出数据源配置对话框（预填充数据）
   ↓
用户修改配置信息
   ↓
（后续流程同创建数据源）
```

**交互要点**:
- 对话框标题显示"编辑数据源"
- 所有字段预填充现有数据
- 密码字段显示为 "••••••"，可选择修改

#### 1.3 删除数据源

```
用户点击数据源列表中的"删除"按钮
   ↓
弹出确认对话框
   ├─ 标题: "确认删除"
   ├─ 内容: "确定要删除数据源 [名称] 吗？此操作不可恢复。"
   └─ 按钮: [取消] [确定删除]
   ↓
用户点击"确定删除"
   ├─ 显示加载状态
   ├─ 成功 → 刷新列表，显示成功提示
   └─ 失败 → 显示错误信息
```

**交互要点**:
- 删除操作需要二次确认
- 确认对话框突出显示数据源名称
- 删除按钮使用警告色（红色）

---

### 2. 任务配置流程（向导式）

#### 2.1 整体流程

```
用户点击"创建任务"按钮
   ↓
进入任务配置向导（步骤 1/5）
   ↓
步骤 1: 选择数据源类型
   ├─ 选择源类型（MySQL/ES）
   └─ 选择目标类型（MySQL/ES）
   ↓
步骤 2: 选择数据源
   ├─ 选择源数据源
   └─ 选择目标数据源
   ↓
步骤 3: 选择表/索引
   ├─ MySQL: 选择数据库和表
   └─ ES: 筛选和选择索引
   ↓
步骤 4: 配置同步参数
   ├─ 批次大小
   ├─ 线程数
   ├─ 错误策略
   └─ 表存在策略
   ↓
步骤 5: 确认配置
   ├─ 预览所有配置
   └─ 输入任务名称
   ↓
保存任务
   ├─ 成功 → 跳转到任务列表，显示成功提示
   └─ 失败 → 显示错误信息，停留在当前步骤
```

#### 2.2 步骤导航

**导航规则**:
- 显示步骤进度条（1/5, 2/5, ...）
- 当前步骤高亮显示
- 已完成步骤显示勾选标记
- 未完成步骤置灰

**按钮状态**:
- 第一步：只显示"下一步"按钮
- 中间步骤：显示"上一步"和"下一步"按钮
- 最后一步：显示"上一步"和"保存"按钮
- 当前步骤未完成时，"下一步"按钮禁用

#### 2.3 步骤 1: 选择数据源类型

**交互方式**:
- 使用卡片式选择
- 四种组合：MySQL→ES, ES→MySQL, MySQL→MySQL, ES→ES
- 鼠标悬停时卡片高亮
- 点击后卡片显示选中状态（边框高亮）

**验证规则**:
- 必须选择一种组合才能进入下一步

#### 2.4 步骤 2: 选择数据源

**交互方式**:
- 使用下拉选择框
- 显示数据源名称和类型
- 如果没有可用数据源，显示"暂无数据源，请先创建"
- 提供"快速创建数据源"链接

**验证规则**:
- 源数据源和目标数据源必须都选择
- 源和目标不能是同一个数据源

#### 2.5 步骤 3: 选择表/索引

**MySQL 表选择**:
```
左侧：数据库列表
   ├─ 显示所有数据库
   ├─ 点击数据库展开表列表
   └─ 支持搜索过滤

右侧：表选择
   ├─ 显示当前数据库的所有表
   ├─ 复选框批量选择
   ├─ 全选/取消全选
   └─ 显示已选择数量
```

**ES 索引选择**:
```
筛选区域：
   ├─ 索引名称模糊搜索
   ├─ 按前缀筛选
   └─ 按日期范围筛选

索引列表：
   ├─ 显示索引名称、文档数、大小
   ├─ 复选框批量选择
   ├─ 全选/取消全选
   └─ 显示已选择数量
```

**验证规则**:
- 至少选择一个表/索引

#### 2.6 步骤 4: 配置同步参数

**表单字段**:
- 批次大小：数字输入框，默认 2500
- 线程数：数字输入框，默认 4
- 错误策略：单选框（跳过/暂停）
- 表存在策略：单选框（删除重建/清空/备份）

**交互要点**:
- 每个字段提供说明文字
- 数字输入框限制范围（批次：100-10000，线程：1-20）
- 提供"恢复默认值"按钮

#### 2.7 步骤 5: 确认配置

**显示内容**:
- 任务名称输入框
- 数据源信息（只读）
- 选择的表/索引列表（只读）
- 同步参数（只读）
- 提供"返回修改"链接

**验证规则**:
- 任务名称必填
- 任务名称不能重复

---

### 3. 任务监控流程

#### 3.1 启动任务

```
用户在任务列表点击"启动"按钮
   ↓
按钮变为加载状态
   ↓
任务启动成功
   ├─ 按钮变为"暂停"
   ├─ 任务状态变为"运行中"
   ├─ 显示进度条
   └─ 开始接收实时进度更新
```

**交互要点**:
- 启动按钮在任务运行时禁用
- 显示加载动画
- 启动失败时显示错误提示

#### 3.2 查看任务详情

```
用户点击任务列表中的任务
   ↓
进入任务监控页面
   ├─ 顶部：任务控制区（启动/暂停/停止）
   ├─ 中部：进度面板
   │   ├─ 总体进度
   │   ├─ 任务单元列表
   │   └─ 实时速度和预计时间
   └─ 底部：日志面板
       ├─ 实时日志
       ├─ 明细日志
       ├─ 校验日志
       └─ 错误日志
```

#### 3.3 实时进度更新

**更新机制**:
- 使用 Tauri Event 推送
- 每秒更新一次进度
- 进度条平滑过渡动画
- 任务单元状态实时变化

**视觉反馈**:
- 进度条颜色：蓝色（进行中）、绿色（完成）、红色（失败）
- 任务单元状态图标：⏳（等待）、▶️（运行中）、✅（完成）、❌（失败）

#### 3.4 暂停和恢复

```
用户点击"暂停"按钮
   ↓
显示确认对话框："确定要暂停任务吗？"
   ↓
用户确认
   ├─ 按钮变为加载状态
   ├─ 任务暂停成功
   ├─ 按钮变为"继续"
   └─ 任务状态变为"已暂停"

用户点击"继续"按钮
   ↓
（流程同启动任务）
```

#### 3.5 停止任务

```
用户点击"停止"按钮
   ↓
显示确认对话框："确定要停止任务吗？停止后需要重新开始。"
   ↓
用户确认
   ├─ 按钮变为加载状态
   ├─ 任务停止成功
   ├─ 按钮变为"启动"
   └─ 任务状态变为"空闲"
```

---

## 📝 表单验证规则

### 1. 数据源表单

| 字段 | 验证规则 | 错误提示 |
|------|---------|---------|
| 名称 | 必填，2-50字符 | "请输入数据源名称（2-50字符）" |
| 类型 | 必选 | "请选择数据源类型" |
| 主机 | 必填，IP或域名格式 | "请输入有效的主机地址" |
| 端口 | 必填，1-65535 | "请输入有效的端口号（1-65535）" |
| 用户名 | 必填 | "请输入用户名" |
| 密码 | 必填 | "请输入密码" |
| 数据库名 | MySQL必填 | "请输入数据库名称" |

### 2. 任务配置表单

| 字段 | 验证规则 | 错误提示 |
|------|---------|---------|
| 任务名称 | 必填，2-50字符，唯一 | "请输入任务名称（2-50字符）" |
| 源数据源 | 必选 | "请选择源数据源" |
| 目标数据源 | 必选，不能与源相同 | "请选择目标数据源" |
| 表/索引 | 至少选择一个 | "请至少选择一个表/索引" |
| 批次大小 | 100-10000 | "批次大小范围：100-10000" |
| 线程数 | 1-20 | "线程数范围：1-20" |

---

## 💬 反馈机制

### 1. 成功反馈

**显示方式**: 
- 使用 Toast 提示（右上角）
- 绿色背景，白色文字
- 显示 3 秒后自动消失
- 可手动关闭

**文案示例**:
- "数据源创建成功"
- "任务保存成功"
- "任务启动成功"

### 2. 错误反馈

**显示方式**:
- 使用 Toast 提示（右上角）
- 红色背景，白色文字
- 显示 5 秒后自动消失
- 可手动关闭

**文案示例**:
- "连接失败：无法连接到数据库"
- "保存失败：任务名称已存在"
- "启动失败：数据源不可用"

### 3. 警告反馈

**显示方式**:
- 使用 Toast 提示（右上角）
- 橙色背景，白色文字
- 显示 4 秒后自动消失

**文案示例**:
- "部分索引同步失败，请查看错误日志"
- "网络连接不稳定，可能影响同步速度"

### 4. 加载状态

**显示方式**:
- 按钮：显示加载图标，禁用点击
- 列表：显示骨架屏
- 对话框：显示遮罩层和加载动画

**文案示例**:
- "正在连接..."
- "正在保存..."
- "正在加载..."

---

## 🎨 交互动画

### 1. 页面切换
- 淡入淡出动画
- 持续时间：300ms

### 2. 对话框
- 从中心缩放弹出
- 持续时间：200ms

### 3. 列表项
- 悬停时轻微放大
- 点击时轻微缩小
- 持续时间：150ms

### 4. 进度条
- 平滑过渡动画
- 持续时间：500ms

### 5. Toast 提示
- 从右侧滑入
- 持续时间：300ms

---

## 🔔 确认对话框规范

### 1. 删除确认

**标题**: "确认删除"  
**内容**: "确定要删除 [对象名称] 吗？此操作不可恢复。"  
**按钮**: [取消] [确定删除]  
**按钮颜色**: 取消（默认）、确定删除（红色）

### 2. 停止任务确认

**标题**: "确认停止"  
**内容**: "确定要停止任务吗？停止后需要重新开始。"  
**按钮**: [取消] [确定停止]  
**按钮颜色**: 取消（默认）、确定停止（橙色）

### 3. 暂停任务确认

**标题**: "确认暂停"  
**内容**: "确定要暂停任务吗？"  
**按钮**: [取消] [确定暂停]  
**按钮颜色**: 取消（默认）、确定暂停（蓝色）

---

## 📱 响应式设计

### 1. 最小宽度
- 应用最小宽度：1280px
- 不支持移动端

### 2. 布局适配
- 使用弹性布局
- 内容区域自适应宽度
- 侧边栏固定宽度

---

## ♿ 可访问性

### 1. 键盘导航
- 支持 Tab 键切换焦点
- 支持 Enter 键确认
- 支持 Esc 键取消/关闭

### 2. 焦点指示
- 焦点元素显示明显边框
- 使用蓝色边框

### 3. 屏幕阅读器
- 所有交互元素提供 aria-label
- 表单字段关联 label

---

## 📚 相关文档

- [UI设计](./UI设计.md) - UI 布局和样式
- [技术规范](../architecture/技术规范.md) - 技术规范
- [API接口设计](../architecture/API接口设计.md) - API 接口

---

**文档维护**: DataTrac 开发团队  
**最后更新**: 2026-01-30
